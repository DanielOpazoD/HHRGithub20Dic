
> hanga-roa-hospital-tracker@0.0.0 test
> vitest --run

Warning: Starting in Storybook 8.5.0-alpha.18, the "test.include" option in Vitest is discouraged in favor of just using the "stories" field in your Storybook configuration.

The values you passed to "test.include" will be ignored, please remove them from your Vitest configuration where the Storybook plugin is applied.

More info: https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#addon-test-indexing-behavior-of-storybookaddon-test-is-changed

[1m[46m RUN [49m[22m [36mv4.0.15 [39m[90m/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main[39m

[90mstdout[2m | tests/hooks/useDailyRecordSync.test.ts[2m > [22m[2museDailyRecordSync - Reconnection Logic[2m > [22m[2mshould push local data to Firestore if Online and isFirebaseConnected is true
[22m[39m[Sync] Initializing Firestore subscription for: 2025-12-27
[useDailyRecordSync] Deep sync triggered for: 2025-12-27

[90mstdout[2m | tests/hooks/useDailyRecordSync.test.ts[2m > [22m[2museDailyRecordSync - Reconnection Logic[2m > [22m[2mshould push local data to Firestore if Online and isFirebaseConnected is true
[22m[39m[useDailyRecordSync] Local data found but no Firestore record. Pushing local to cloud.

 [32mâœ“[39m [30m[42m unit [49m[39m tests/components/NavbarMenu.test.tsx [2m([22m[2m8 tests[22m[2m)[22m[32m 181[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/services/censusMasterWorkbook.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 92[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/components/UserMenu.test.tsx [2m([22m[2m7 tests[22m[2m)[22m[32m 232[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/services/excelExport.test.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 365[2mms[22m[39m
[90mstdout[2m | tests/components/PatientRow.test.tsx
[22m[39mðŸ”„ Starting migration from localStorage to IndexedDB...

[90mstdout[2m | tests/integration/patient.test.tsx
[22m[39mðŸ”„ Starting migration from localStorage to IndexedDB...

[90mstdout[2m | tests/integration/patient.test.tsx
[22m[39mâœ… Migration complete!

[90mstdout[2m | tests/components/PatientRow.test.tsx
[22m[39mâœ… Migration complete!

 [31mâ¯[39m [30m[42m unit [49m[39m tests/hooks/useDailyRecord.test.ts [2m([22m[2m9 tests[22m[2m | [22m[31m9 failed[39m[2m)[22m[32m 19[2mms[22m[39m
[31m     [31mÃ—[31m should initialize with record for the given date[39m[32m 9[2mms[22m[39m
[31m     [31mÃ—[31m should subscribe to updates on mount[39m[32m 2[2mms[22m[39m
[31m     [31mÃ—[31m should update record when date changes[39m[32m 2[2mms[22m[39m
[31m     [31mÃ—[31m should handle remote updates correctly[39m[32m 1[2mms[22m[39m
[31m     [31mÃ—[31m should create a new day[39m[32m 2[2mms[22m[39m
[31m     [31mÃ—[31m should not move patient if source bed is empty[39m[32m 1[2mms[22m[39m
[31m     [31mÃ—[31m should not update admissionDate to a future date[39m[32m 1[2mms[22m[39m
[31m     [31mÃ—[31m should not create clinical crib in empty bed[39m[32m 1[2mms[22m[39m
[31m     [31mÃ—[31m should not update crib admissionDate to a future date[39m[32m 1[2mms[22m[39m
[90mstdout[2m | tests/components/PatientRow.test.tsx[2m > [22m[2mPatientRow Component[2m > [22m[2mrenders patient name and bed name correctly
[22m[39m[useAuthState] ðŸš€ Initializing Auth System...
[useAuthState] ðŸ“¡ Subscribing to Firebase Auth changes...
[authService] ðŸŽ§ Setting up onAuthStateChanged observer

[90mstdout[2m | tests/components/PatientRow.test.tsx[2m > [22m[2mPatientRow Component[2m > [22m[2mrenders patient name and bed name correctly
[22m[39m[useAuthState] ðŸ§¹ Cleaning up Auth subscription

[90mstdout[2m | tests/components/PatientRow.test.tsx[2m > [22m[2mPatientRow Component[2m > [22m[2mtoggles UPC status when clicked
[22m[39m[useAuthState] ðŸš€ Initializing Auth System...
[useAuthState] ðŸ“¡ Subscribing to Firebase Auth changes...
[authService] ðŸŽ§ Setting up onAuthStateChanged observer

[90mstdout[2m | tests/components/PatientRow.test.tsx[2m > [22m[2mPatientRow Component[2m > [22m[2mtoggles UPC status when clicked
[22m[39m[useAuthState] ðŸ§¹ Cleaning up Auth subscription

[90mstdout[2m | tests/integration/patient.test.tsx[2m > [22m[2mPatient Management Integration[2m > [22m[2mPatientRow Component[2m > [22m[2mshould render empty bed correctly
[22m[39m[useAuthState] ðŸš€ Initializing Auth System...
[useAuthState] ðŸ“¡ Subscribing to Firebase Auth changes...
[authService] ðŸŽ§ Setting up onAuthStateChanged observer

[90mstdout[2m | tests/integration/patient.test.tsx[2m > [22m[2mPatient Management Integration[2m > [22m[2mPatientRow Component[2m > [22m[2mshould render empty bed correctly
[22m[39m[useAuthState] ðŸ§¹ Cleaning up Auth subscription

[90mstdout[2m | tests/components/PatientRow.test.tsx[2m > [22m[2mPatientRow Component[2m > [22m[2mcalls updatePatient when status changes
[22m[39m[useAuthState] ðŸš€ Initializing Auth System...
[useAuthState] ðŸ“¡ Subscribing to Firebase Auth changes...
[authService] ðŸŽ§ Setting up onAuthStateChanged observer

[90mstdout[2m | tests/components/PatientRow.test.tsx[2m > [22m[2mPatientRow Component[2m > [22m[2mcalls updatePatient when status changes
[22m[39m[useAuthState] ðŸ§¹ Cleaning up Auth subscription

[90mstdout[2m | tests/components/PatientRow.test.tsx[2m > [22m[2mPatientRow Component[2m > [22m[2mCrib and Bed Mode Management[2m > [22m[2mtoggles bed mode when config button is clicked
[22m[39m[useAuthState] ðŸš€ Initializing Auth System...
[useAuthState] ðŸ“¡ Subscribing to Firebase Auth changes...
[authService] ðŸŽ§ Setting up onAuthStateChanged observer

[90mstdout[2m | tests/components/PatientRow.test.tsx[2m > [22m[2mPatientRow Component[2m > [22m[2mCrib and Bed Mode Management[2m > [22m[2mtoggles bed mode when config button is clicked
[22m[39m[useAuthState] ðŸ§¹ Cleaning up Auth subscription

[90mstdout[2m | tests/integration/patient.test.tsx[2m > [22m[2mPatient Management Integration[2m > [22m[2mPatientRow Component[2m > [22m[2mshould render patient data correctly
[22m[39m[useAuthState] ðŸš€ Initializing Auth System...
[useAuthState] ðŸ“¡ Subscribing to Firebase Auth changes...
[authService] ðŸŽ§ Setting up onAuthStateChanged observer

[90mstdout[2m | tests/components/PatientRow.test.tsx[2m > [22m[2mPatientRow Component[2m > [22m[2mCrib and Bed Mode Management[2m > [22m[2mtoggles companion crib when RN Sano button is clicked
[22m[39m[useAuthState] ðŸš€ Initializing Auth System...
[useAuthState] ðŸ“¡ Subscribing to Firebase Auth changes...
[authService] ðŸŽ§ Setting up onAuthStateChanged observer

[90mstdout[2m | tests/components/PatientRow.test.tsx[2m > [22m[2mPatientRow Component[2m > [22m[2mCrib and Bed Mode Management[2m > [22m[2mtoggles companion crib when RN Sano button is clicked
[22m[39m[useAuthState] ðŸ§¹ Cleaning up Auth subscription

[90mstdout[2m | tests/integration/patient.test.tsx[2m > [22m[2mPatient Management Integration[2m > [22m[2mPatientRow Component[2m > [22m[2mshould render patient data correctly
[22m[39m[useAuthState] ðŸ§¹ Cleaning up Auth subscription

[90mstdout[2m | tests/components/PatientRow.test.tsx[2m > [22m[2mPatientRow Component[2m > [22m[2mCrib and Bed Mode Management[2m > [22m[2mtoggles clinical crib when Cuna ClÃ­nica button is clicked
[22m[39m[useAuthState] ðŸš€ Initializing Auth System...
[useAuthState] ðŸ“¡ Subscribing to Firebase Auth changes...
[authService] ðŸŽ§ Setting up onAuthStateChanged observer

[90mstdout[2m | tests/components/PatientRow.test.tsx[2m > [22m[2mPatientRow Component[2m > [22m[2mCrib and Bed Mode Management[2m > [22m[2mtoggles clinical crib when Cuna ClÃ­nica button is clicked
[22m[39m[useAuthState] ðŸ§¹ Cleaning up Auth subscription

[90mstdout[2m | tests/integration/patient.test.tsx[2m > [22m[2mPatient Management Integration[2m > [22m[2mPatientRow Component[2m > [22m[2mshould render blocked bed with visual indicator
[22m[39m[useAuthState] ðŸš€ Initializing Auth System...
[useAuthState] ðŸ“¡ Subscribing to Firebase Auth changes...
[authService] ðŸŽ§ Setting up onAuthStateChanged observer

[90mstdout[2m | tests/integration/patient.test.tsx[2m > [22m[2mPatient Management Integration[2m > [22m[2mPatientRow Component[2m > [22m[2mshould render blocked bed with visual indicator
[22m[39m[useAuthState] ðŸ§¹ Cleaning up Auth subscription

[90mstdout[2m | tests/components/PatientRow.test.tsx[2m > [22m[2mPatientRow Component[2m > [22m[2mBlocked Bed View[2m > [22m[2mrenders blocked message and reason instead of inputs
[22m[39m[useAuthState] ðŸš€ Initializing Auth System...
[useAuthState] ðŸ“¡ Subscribing to Firebase Auth changes...
[authService] ðŸŽ§ Setting up onAuthStateChanged observer

[90mstdout[2m | tests/components/PatientRow.test.tsx[2m > [22m[2mPatientRow Component[2m > [22m[2mBlocked Bed View[2m > [22m[2mrenders blocked message and reason instead of inputs
[22m[39m[useAuthState] ðŸ§¹ Cleaning up Auth subscription

[90mstdout[2m | tests/integration/patient.test.tsx[2m > [22m[2mPatient Management Integration[2m > [22m[2mPatientRow Component[2m > [22m[2mshould render UPC patient with special indicator
[22m[39m[useAuthState] ðŸš€ Initializing Auth System...
[useAuthState] ðŸ“¡ Subscribing to Firebase Auth changes...
[authService] ðŸŽ§ Setting up onAuthStateChanged observer

[90mstdout[2m | tests/integration/patient.test.tsx[2m > [22m[2mPatient Management Integration[2m > [22m[2mPatientRow Component[2m > [22m[2mshould render UPC patient with special indicator
[22m[39m[useAuthState] ðŸ§¹ Cleaning up Auth subscription

[90mstdout[2m | tests/integration/patient.test.tsx[2m > [22m[2mPatient Management Integration[2m > [22m[2mPatient with Devices[2m > [22m[2mshould display devices correctly
[22m[39m[useAuthState] ðŸš€ Initializing Auth System...
[useAuthState] ðŸ“¡ Subscribing to Firebase Auth changes...
[authService] ðŸŽ§ Setting up onAuthStateChanged observer

[90mstdout[2m | tests/integration/patient.test.tsx[2m > [22m[2mPatient Management Integration[2m > [22m[2mPatient with Devices[2m > [22m[2mshould display devices correctly
[22m[39m[useAuthState] ðŸ§¹ Cleaning up Auth subscription

[90mstdout[2m | tests/integration/patient.test.tsx
[22m[39m[authService] ðŸ‘¤ Firebase onAuthStateChanged triggered. User: test@hospital.cl
[authService] ðŸ” Checking whitelist for: test@hospital.cl

[90mstdout[2m | tests/integration/patient.test.tsx
[22m[39m[authService] ðŸ‘¤ Firebase onAuthStateChanged triggered. User: test@hospital.cl
[authService] ðŸ” Checking whitelist for: test@hospital.cl

[90mstdout[2m | tests/integration/patient.test.tsx
[22m[39m[authService] ðŸ‘¤ Firebase onAuthStateChanged triggered. User: test@hospital.cl
[authService] ðŸ” Checking whitelist for: test@hospital.cl

[90mstdout[2m | tests/integration/patient.test.tsx
[22m[39m[authService] ðŸ‘¤ Firebase onAuthStateChanged triggered. User: test@hospital.cl
[authService] ðŸ” Checking whitelist for: test@hospital.cl

[90mstdout[2m | tests/integration/patient.test.tsx
[22m[39m[authService] ðŸ‘¤ Firebase onAuthStateChanged triggered. User: test@hospital.cl
[authService] ðŸ” Checking whitelist for: test@hospital.cl

 [32mâœ“[39m [30m[42m unit [49m[39m tests/integration/patient.test.tsx [2m([22m[2m5 tests[22m[2m)[22m[32m 95[2mms[22m[39m
[90mstderr[2m | checkEmailInFirestore (/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/services/auth/authService.ts:167:17)
[22m[39m[authService] â€¼ï¸ Error checking allowed users in Firestore: [FirebaseError: Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore] {
  code: [32m'invalid-argument'[39m,
  customData: [90mundefined[39m,
  toString: [36m[Function (anonymous)][39m
}

[90mstdout[2m | hooks/useAuthState.ts:219:25
[22m[39m[useAuthState] ðŸ”” Auth State Change received: NULL

[90mstdout[2m | hooks/useAuthState.ts:250:29
[22m[39m[useAuthState] ðŸ‘¤ Firebase user is NULL, checking offline fallback...

[90mstdout[2m | checkOfflineUser (/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/hooks/useAuthState.ts:177:21)
[22m[39m[useAuthState] ðŸ” Checking local storage for offline user...

[90mstderr[2m | checkEmailInFirestore (/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/services/auth/authService.ts:167:17)
[22m[39m[authService] â€¼ï¸ Error checking allowed users in Firestore: [FirebaseError: Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore] {
  code: [32m'invalid-argument'[39m,
  customData: [90mundefined[39m,
  toString: [36m[Function (anonymous)][39m
}

[90mstdout[2m | hooks/useAuthState.ts:219:25
[22m[39m[useAuthState] ðŸ”” Auth State Change received: NULL

[90mstdout[2m | hooks/useAuthState.ts:250:29
[22m[39m[useAuthState] ðŸ‘¤ Firebase user is NULL, checking offline fallback...

[90mstdout[2m | checkOfflineUser (/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/hooks/useAuthState.ts:177:21)
[22m[39m[useAuthState] ðŸ” Checking local storage for offline user...

[90mstderr[2m | checkEmailInFirestore (/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/services/auth/authService.ts:167:17)
[22m[39m[authService] â€¼ï¸ Error checking allowed users in Firestore: [FirebaseError: Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore] {
  code: [32m'invalid-argument'[39m,
  customData: [90mundefined[39m,
  toString: [36m[Function (anonymous)][39m
}

[90mstdout[2m | hooks/useAuthState.ts:219:25
[22m[39m[useAuthState] ðŸ”” Auth State Change received: NULL

[90mstdout[2m | hooks/useAuthState.ts:250:29
[22m[39m[useAuthState] ðŸ‘¤ Firebase user is NULL, checking offline fallback...

[90mstdout[2m | checkOfflineUser (/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/hooks/useAuthState.ts:177:21)
[22m[39m[useAuthState] ðŸ” Checking local storage for offline user...

[90mstderr[2m | checkEmailInFirestore (/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/services/auth/authService.ts:167:17)
[22m[39m[authService] â€¼ï¸ Error checking allowed users in Firestore: [FirebaseError: Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore] {
  code: [32m'invalid-argument'[39m,
  customData: [90mundefined[39m,
  toString: [36m[Function (anonymous)][39m
}

[90mstdout[2m | hooks/useAuthState.ts:219:25
[22m[39m[useAuthState] ðŸ”” Auth State Change received: NULL

[90mstdout[2m | hooks/useAuthState.ts:250:29
[22m[39m[useAuthState] ðŸ‘¤ Firebase user is NULL, checking offline fallback...

[90mstdout[2m | checkOfflineUser (/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/hooks/useAuthState.ts:177:21)
[22m[39m[useAuthState] ðŸ” Checking local storage for offline user...

[90mstderr[2m | checkEmailInFirestore (/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/services/auth/authService.ts:167:17)
[22m[39m[authService] â€¼ï¸ Error checking allowed users in Firestore: [FirebaseError: Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore] {
  code: [32m'invalid-argument'[39m,
  customData: [90mundefined[39m,
  toString: [36m[Function (anonymous)][39m
}

[90mstdout[2m | hooks/useAuthState.ts:219:25
[22m[39m[useAuthState] ðŸ”” Auth State Change received: NULL

[90mstdout[2m | hooks/useAuthState.ts:250:29
[22m[39m[useAuthState] ðŸ‘¤ Firebase user is NULL, checking offline fallback...

[90mstdout[2m | checkOfflineUser (/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/hooks/useAuthState.ts:177:21)
[22m[39m[useAuthState] ðŸ” Checking local storage for offline user...

[90mstdout[2m | hooks/useAuthState.ts:258:25
[22m[39m[useAuthState] âœ¨ Auth transition finished

[90mstdout[2m | hooks/useAuthState.ts:258:25
[22m[39m[useAuthState] âœ¨ Auth transition finished

[90mstdout[2m | hooks/useAuthState.ts:258:25
[22m[39m[useAuthState] âœ¨ Auth transition finished

[90mstdout[2m | hooks/useAuthState.ts:258:25
[22m[39m[useAuthState] âœ¨ Auth transition finished

[90mstdout[2m | hooks/useAuthState.ts:258:25
[22m[39m[useAuthState] âœ¨ Auth transition finished

[90mstdout[2m | tests/components/PatientRow.test.tsx[2m > [22m[2mPatientRow Component[2m > [22m[2mDemographics Modal[2m > [22m[2mopens demographics modal and saves changes
[22m[39m[useAuthState] ðŸš€ Initializing Auth System...
[useAuthState] ðŸ“¡ Subscribing to Firebase Auth changes...
[authService] ðŸŽ§ Setting up onAuthStateChanged observer

[90mstderr[2m | tests/components/PatientRow.test.tsx[2m > [22m[2mPatientRow Component[2m > [22m[2mDemographics Modal[2m > [22m[2mopens demographics modal and saves changes
[22m[39mIn HTML, <div> cannot be a child of <tbody>.
This will cause a hydration error.

  <wrapper>
    <AllProviders contextValue={{...}}>
      <QueryClientProvider client={{}}>
        <UIProvider>
          <AuthProvider>
            <AuditProvider userId="test-user">
              <DemoModeProvider>
                <DailyRecordProvider value={{...}}>
                  <table>
>                   <tbody>
                      <PatientRowComponent data={{bedId:"R1", ...}} bed={{id:"R1",name:"R1", ...}} ...>
                        <tr>
                        <DemographicsModal isOpen={true} onClose={function onClose} data={{bedId:"R1", ...}} ...>
                          <BaseModal isOpen={true} onClose={function onClose} title="Datos Demo..." icon={<User>} ...>
>                           <div
>                             className="fixed inset-0 bg-slate-900/60 z-50 flex items-center justify-center p-4 backd..."
>                             onClick={function handleBackdropClick}
>                             role="dialog"
>                             aria-modal="true"
>                             aria-labelledby="modal-title"
>                           >
          ...

<tbody> cannot contain a nested <div>.
See this log for the ancestor stack trace.

[90mstdout[2m | tests/components/PatientRow.test.tsx[2m > [22m[2mPatientRow Component[2m > [22m[2mDemographics Modal[2m > [22m[2mopens demographics modal and saves changes
[22m[39m[useAuthState] ðŸ§¹ Cleaning up Auth subscription

[90mstdout[2m | tests/components/PatientRow.test.tsx[2m > [22m[2mPatientRow Component[2m > [22m[2mAction Menu[2m > [22m[2mcalls onAction when copy, move, discharge, or transfer is clicked
[22m[39m[useAuthState] ðŸš€ Initializing Auth System...
[useAuthState] ðŸ“¡ Subscribing to Firebase Auth changes...
[authService] ðŸŽ§ Setting up onAuthStateChanged observer

[90mstdout[2m | tests/components/PatientRow.test.tsx[2m > [22m[2mPatientRow Component[2m > [22m[2mAction Menu[2m > [22m[2mcalls onAction when copy, move, discharge, or transfer is clicked
[22m[39m[useAuthState] ðŸ§¹ Cleaning up Auth subscription

[90mstdout[2m | tests/components/PatientRow.test.tsx[2m > [22m[2mPatientRow Component[2m > [22m[2mAction Menu[2m > [22m[2mcloses menu when clicking background overlay
[22m[39m[useAuthState] ðŸš€ Initializing Auth System...
[useAuthState] ðŸ“¡ Subscribing to Firebase Auth changes...
[authService] ðŸŽ§ Setting up onAuthStateChanged observer

[90mstdout[2m | tests/components/PatientRow.test.tsx[2m > [22m[2mPatientRow Component[2m > [22m[2mAction Menu[2m > [22m[2mcloses menu when clicking background overlay
[22m[39m[useAuthState] ðŸ§¹ Cleaning up Auth subscription

[90mstdout[2m | tests/components/PatientRow.test.tsx[2m > [22m[2mPatientRow Component[2m > [22m[2mAdmission Time and Input Logic[2m > [22m[2mshows admission time input when admission date is focused
[22m[39m[useAuthState] ðŸš€ Initializing Auth System...
[useAuthState] ðŸ“¡ Subscribing to Firebase Auth changes...
[authService] ðŸŽ§ Setting up onAuthStateChanged observer

[90mstdout[2m | tests/components/PatientRow.test.tsx[2m > [22m[2mPatientRow Component[2m > [22m[2mAdmission Time and Input Logic[2m > [22m[2mshows admission time input when admission date is focused
[22m[39m[useAuthState] ðŸ§¹ Cleaning up Auth subscription

[90mstdout[2m | tests/components/PatientRow.test.tsx[2m > [22m[2mPatientRow Component[2m > [22m[2mAdmission Time and Input Logic[2m > [22m[2mtriggers updatePatient on debounced name change
[22m[39m[useAuthState] ðŸš€ Initializing Auth System...
[useAuthState] ðŸ“¡ Subscribing to Firebase Auth changes...
[authService] ðŸŽ§ Setting up onAuthStateChanged observer
[authService] ðŸ‘¤ Firebase onAuthStateChanged triggered. User: test@hospital.cl
[authService] ðŸ” Checking whitelist for: test@hospital.cl

[90mstderr[2m | tests/components/PatientRow.test.tsx[2m > [22m[2mPatientRow Component[2m > [22m[2mAdmission Time and Input Logic[2m > [22m[2mtriggers updatePatient on debounced name change
[22m[39m[authService] â€¼ï¸ Error checking allowed users in Firestore: [FirebaseError: Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore] {
  code: [32m'invalid-argument'[39m,
  customData: [90mundefined[39m,
  toString: [36m[Function (anonymous)][39m
}

[90mstdout[2m | tests/components/PatientRow.test.tsx[2m > [22m[2mPatientRow Component[2m > [22m[2mAdmission Time and Input Logic[2m > [22m[2mtriggers updatePatient on debounced name change
[22m[39m[useAuthState] ðŸ§¹ Cleaning up Auth subscription

[90mstdout[2m | tests/components/PatientRow.test.tsx[2m > [22m[2mPatientRow Component[2m > [22m[2mAdmission Time and Input Logic[2m > [22m[2mtriggers updatePatient on debounced name change
[22m[39m[useAuthState] ðŸ”” Auth State Change received: NULL
[useAuthState] ðŸ‘¤ Firebase user is NULL, checking offline fallback...
[useAuthState] ðŸ” Checking local storage for offline user...

[90mstdout[2m | tests/components/PatientRow.test.tsx[2m > [22m[2mPatientRow Component[2m > [22m[2mClinical Crib Management - Edge Cases[2m > [22m[2mremoves clinical crib if it already exists
[22m[39m[useAuthState] ðŸš€ Initializing Auth System...
[useAuthState] ðŸ“¡ Subscribing to Firebase Auth changes...
[authService] ðŸŽ§ Setting up onAuthStateChanged observer

[90mstdout[2m | tests/components/PatientRow.test.tsx[2m > [22m[2mPatientRow Component[2m > [22m[2mClinical Crib Management - Edge Cases[2m > [22m[2mremoves clinical crib if it already exists
[22m[39m[useAuthState] ðŸ§¹ Cleaning up Auth subscription

[90mstdout[2m | tests/components/PatientRow.test.tsx[2m > [22m[2mPatientRow Component[2m > [22m[2mClinical Crib Management - Edge Cases[2m > [22m[2mdoes not allow companion crib if in Cuna mode
[22m[39m[useAuthState] ðŸš€ Initializing Auth System...
[useAuthState] ðŸ“¡ Subscribing to Firebase Auth changes...
[authService] ðŸŽ§ Setting up onAuthStateChanged observer

[90mstdout[2m | tests/components/PatientRow.test.tsx[2m > [22m[2mPatientRow Component[2m > [22m[2mClinical Crib Management - Edge Cases[2m > [22m[2mdoes not allow companion crib if in Cuna mode
[22m[39m[useAuthState] ðŸ§¹ Cleaning up Auth subscription

[90mstdout[2m | tests/components/PatientRow.test.tsx[2m > [22m[2mPatientRow Component[2m > [22m[2mClinical Crib Sub-row[2m > [22m[2mrenders sub-row when clinicalCrib exists
[22m[39m[useAuthState] ðŸš€ Initializing Auth System...
[useAuthState] ðŸ“¡ Subscribing to Firebase Auth changes...
[authService] ðŸŽ§ Setting up onAuthStateChanged observer

[90mstdout[2m | tests/components/PatientRow.test.tsx[2m > [22m[2mPatientRow Component[2m > [22m[2mClinical Crib Sub-row[2m > [22m[2mrenders sub-row when clinicalCrib exists
[22m[39m[useAuthState] ðŸ§¹ Cleaning up Auth subscription

[90mstdout[2m | tests/components/PatientRow.test.tsx[2m > [22m[2mPatientRow Component[2m > [22m[2mClinical Crib Sub-row[2m > [22m[2mopens sub-row demographics modal
[22m[39m[useAuthState] ðŸš€ Initializing Auth System...
[useAuthState] ðŸ“¡ Subscribing to Firebase Auth changes...
[authService] ðŸŽ§ Setting up onAuthStateChanged observer

[90mstdout[2m | tests/components/PatientRow.test.tsx[2m > [22m[2mPatientRow Component[2m > [22m[2mClinical Crib Sub-row[2m > [22m[2mopens sub-row demographics modal
[22m[39m[useAuthState] ðŸ§¹ Cleaning up Auth subscription

[90mstdout[2m | tests/components/PatientRow.test.tsx
[22m[39m[useAuthState] âœ¨ Auth transition finished

[90mstdout[2m | tests/components/PatientRow.test.tsx
[22m[39m[authService] ðŸ‘¤ Firebase onAuthStateChanged triggered. User: test@hospital.cl
[authService] ðŸ” Checking whitelist for: test@hospital.cl

[90mstdout[2m | tests/components/PatientRow.test.tsx
[22m[39m[authService] ðŸ‘¤ Firebase onAuthStateChanged triggered. User: test@hospital.cl
[authService] ðŸ” Checking whitelist for: test@hospital.cl

[90mstdout[2m | tests/components/PatientRow.test.tsx
[22m[39m[authService] ðŸ‘¤ Firebase onAuthStateChanged triggered. User: test@hospital.cl
[authService] ðŸ” Checking whitelist for: test@hospital.cl

[90mstdout[2m | tests/components/PatientRow.test.tsx
[22m[39m[authService] ðŸ‘¤ Firebase onAuthStateChanged triggered. User: test@hospital.cl
[authService] ðŸ” Checking whitelist for: test@hospital.cl

[90mstdout[2m | tests/components/PatientRow.test.tsx
[22m[39m[authService] ðŸ‘¤ Firebase onAuthStateChanged triggered. User: test@hospital.cl
[authService] ðŸ” Checking whitelist for: test@hospital.cl

[90mstdout[2m | tests/components/PatientRow.test.tsx
[22m[39m[authService] ðŸ‘¤ Firebase onAuthStateChanged triggered. User: test@hospital.cl
[authService] ðŸ” Checking whitelist for: test@hospital.cl

[90mstdout[2m | tests/components/PatientRow.test.tsx
[22m[39m[authService] ðŸ‘¤ Firebase onAuthStateChanged triggered. User: test@hospital.cl
[authService] ðŸ” Checking whitelist for: test@hospital.cl

[90mstdout[2m | tests/components/PatientRow.test.tsx
[22m[39m[authService] ðŸ‘¤ Firebase onAuthStateChanged triggered. User: test@hospital.cl
[authService] ðŸ” Checking whitelist for: test@hospital.cl

[90mstdout[2m | tests/components/PatientRow.test.tsx
[22m[39m[authService] ðŸ‘¤ Firebase onAuthStateChanged triggered. User: test@hospital.cl
[authService] ðŸ” Checking whitelist for: test@hospital.cl

[90mstdout[2m | tests/components/PatientRow.test.tsx
[22m[39m[authService] ðŸ‘¤ Firebase onAuthStateChanged triggered. User: test@hospital.cl
[authService] ðŸ” Checking whitelist for: test@hospital.cl

[90mstdout[2m | tests/components/PatientRow.test.tsx
[22m[39m[authService] ðŸ‘¤ Firebase onAuthStateChanged triggered. User: test@hospital.cl
[authService] ðŸ” Checking whitelist for: test@hospital.cl

[90mstdout[2m | tests/components/PatientRow.test.tsx
[22m[39m[authService] ðŸ‘¤ Firebase onAuthStateChanged triggered. User: test@hospital.cl
[authService] ðŸ” Checking whitelist for: test@hospital.cl

[90mstdout[2m | tests/components/PatientRow.test.tsx
[22m[39m[authService] ðŸ‘¤ Firebase onAuthStateChanged triggered. User: test@hospital.cl
[authService] ðŸ” Checking whitelist for: test@hospital.cl

[90mstdout[2m | tests/components/PatientRow.test.tsx
[22m[39m[authService] ðŸ‘¤ Firebase onAuthStateChanged triggered. User: test@hospital.cl
[authService] ðŸ” Checking whitelist for: test@hospital.cl

[90mstdout[2m | tests/components/PatientRow.test.tsx
[22m[39m[authService] ðŸ‘¤ Firebase onAuthStateChanged triggered. User: test@hospital.cl
[authService] ðŸ” Checking whitelist for: test@hospital.cl

[90mstderr[2m | tests/components/PatientRow.test.tsx
[22m[39m[authService] â€¼ï¸ Error checking allowed users in Firestore: [FirebaseError: Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore] {
  code: [32m'invalid-argument'[39m,
  customData: [90mundefined[39m,
  toString: [36m[Function (anonymous)][39m
}

[90mstdout[2m | tests/components/PatientRow.test.tsx
[22m[39m[useAuthState] ðŸ”” Auth State Change received: NULL
[useAuthState] ðŸ‘¤ Firebase user is NULL, checking offline fallback...
[useAuthState] ðŸ” Checking local storage for offline user...

[90mstderr[2m | tests/components/PatientRow.test.tsx
[22m[39m[authService] â€¼ï¸ Error checking allowed users in Firestore: [FirebaseError: Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore] {
  code: [32m'invalid-argument'[39m,
  customData: [90mundefined[39m,
  toString: [36m[Function (anonymous)][39m
}

[90mstdout[2m | tests/components/PatientRow.test.tsx
[22m[39m[useAuthState] ðŸ”” Auth State Change received: NULL
[useAuthState] ðŸ‘¤ Firebase user is NULL, checking offline fallback...
[useAuthState] ðŸ” Checking local storage for offline user...

[90mstderr[2m | tests/components/PatientRow.test.tsx
[22m[39m[authService] â€¼ï¸ Error checking allowed users in Firestore: [FirebaseError: Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore] {
  code: [32m'invalid-argument'[39m,
  customData: [90mundefined[39m,
  toString: [36m[Function (anonymous)][39m
}

[90mstdout[2m | tests/components/PatientRow.test.tsx
[22m[39m[useAuthState] ðŸ”” Auth State Change received: NULL
[useAuthState] ðŸ‘¤ Firebase user is NULL, checking offline fallback...
[useAuthState] ðŸ” Checking local storage for offline user...

[90mstderr[2m | tests/components/PatientRow.test.tsx
[22m[39m[authService] â€¼ï¸ Error checking allowed users in Firestore: [FirebaseError: Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore] {
  code: [32m'invalid-argument'[39m,
  customData: [90mundefined[39m,
  toString: [36m[Function (anonymous)][39m
}

[90mstdout[2m | tests/components/PatientRow.test.tsx
[22m[39m[useAuthState] ðŸ”” Auth State Change received: NULL
[useAuthState] ðŸ‘¤ Firebase user is NULL, checking offline fallback...
[useAuthState] ðŸ” Checking local storage for offline user...

[90mstderr[2m | tests/components/PatientRow.test.tsx
[22m[39m[authService] â€¼ï¸ Error checking allowed users in Firestore: [FirebaseError: Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore] {
  code: [32m'invalid-argument'[39m,
  customData: [90mundefined[39m,
  toString: [36m[Function (anonymous)][39m
}

[90mstdout[2m | tests/components/PatientRow.test.tsx
[22m[39m[useAuthState] ðŸ”” Auth State Change received: NULL
[useAuthState] ðŸ‘¤ Firebase user is NULL, checking offline fallback...
[useAuthState] ðŸ” Checking local storage for offline user...

[90mstderr[2m | tests/components/PatientRow.test.tsx
[22m[39m[authService] â€¼ï¸ Error checking allowed users in Firestore: [FirebaseError: Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore] {
  code: [32m'invalid-argument'[39m,
  customData: [90mundefined[39m,
  toString: [36m[Function (anonymous)][39m
}

[90mstdout[2m | tests/components/PatientRow.test.tsx
[22m[39m[useAuthState] ðŸ”” Auth State Change received: NULL
[useAuthState] ðŸ‘¤ Firebase user is NULL, checking offline fallback...
[useAuthState] ðŸ” Checking local storage for offline user...

[90mstderr[2m | tests/components/PatientRow.test.tsx
[22m[39m[authService] â€¼ï¸ Error checking allowed users in Firestore: [FirebaseError: Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore] {
  code: [32m'invalid-argument'[39m,
  customData: [90mundefined[39m,
  toString: [36m[Function (anonymous)][39m
}

[90mstdout[2m | tests/components/PatientRow.test.tsx
[22m[39m[useAuthState] ðŸ”” Auth State Change received: NULL
[useAuthState] ðŸ‘¤ Firebase user is NULL, checking offline fallback...
[useAuthState] ðŸ” Checking local storage for offline user...

[90mstderr[2m | tests/components/PatientRow.test.tsx
[22m[39m[authService] â€¼ï¸ Error checking allowed users in Firestore: [FirebaseError: Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore] {
  code: [32m'invalid-argument'[39m,
  customData: [90mundefined[39m,
  toString: [36m[Function (anonymous)][39m
}

[90mstdout[2m | tests/components/PatientRow.test.tsx
[22m[39m[useAuthState] ðŸ”” Auth State Change received: NULL
[useAuthState] ðŸ‘¤ Firebase user is NULL, checking offline fallback...
[useAuthState] ðŸ” Checking local storage for offline user...

[90mstderr[2m | tests/components/PatientRow.test.tsx
[22m[39m[authService] â€¼ï¸ Error checking allowed users in Firestore: [FirebaseError: Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore] {
  code: [32m'invalid-argument'[39m,
  customData: [90mundefined[39m,
  toString: [36m[Function (anonymous)][39m
}

[90mstdout[2m | tests/components/PatientRow.test.tsx
[22m[39m[useAuthState] ðŸ”” Auth State Change received: NULL
[useAuthState] ðŸ‘¤ Firebase user is NULL, checking offline fallback...
[useAuthState] ðŸ” Checking local storage for offline user...

[90mstderr[2m | tests/components/PatientRow.test.tsx
[22m[39m[authService] â€¼ï¸ Error checking allowed users in Firestore: [FirebaseError: Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore] {
  code: [32m'invalid-argument'[39m,
  customData: [90mundefined[39m,
  toString: [36m[Function (anonymous)][39m
}

[90mstdout[2m | tests/components/PatientRow.test.tsx
[22m[39m[useAuthState] ðŸ”” Auth State Change received: NULL
[useAuthState] ðŸ‘¤ Firebase user is NULL, checking offline fallback...
[useAuthState] ðŸ” Checking local storage for offline user...

[90mstderr[2m | tests/components/PatientRow.test.tsx
[22m[39m[authService] â€¼ï¸ Error checking allowed users in Firestore: [FirebaseError: Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore] {
  code: [32m'invalid-argument'[39m,
  customData: [90mundefined[39m,
  toString: [36m[Function (anonymous)][39m
}

[90mstdout[2m | tests/components/PatientRow.test.tsx
[22m[39m[useAuthState] ðŸ”” Auth State Change received: NULL
[useAuthState] ðŸ‘¤ Firebase user is NULL, checking offline fallback...
[useAuthState] ðŸ” Checking local storage for offline user...

[90mstderr[2m | tests/components/PatientRow.test.tsx
[22m[39m[authService] â€¼ï¸ Error checking allowed users in Firestore: [FirebaseError: Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore] {
  code: [32m'invalid-argument'[39m,
  customData: [90mundefined[39m,
  toString: [36m[Function (anonymous)][39m
}

[90mstdout[2m | tests/components/PatientRow.test.tsx
[22m[39m[useAuthState] ðŸ”” Auth State Change received: NULL
[useAuthState] ðŸ‘¤ Firebase user is NULL, checking offline fallback...
[useAuthState] ðŸ” Checking local storage for offline user...

[90mstderr[2m | tests/components/PatientRow.test.tsx
[22m[39m[authService] â€¼ï¸ Error checking allowed users in Firestore: [FirebaseError: Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore] {
  code: [32m'invalid-argument'[39m,
  customData: [90mundefined[39m,
  toString: [36m[Function (anonymous)][39m
}

[90mstdout[2m | tests/components/PatientRow.test.tsx
[22m[39m[useAuthState] ðŸ”” Auth State Change received: NULL
[useAuthState] ðŸ‘¤ Firebase user is NULL, checking offline fallback...
[useAuthState] ðŸ” Checking local storage for offline user...

[90mstderr[2m | tests/components/PatientRow.test.tsx
[22m[39m[authService] â€¼ï¸ Error checking allowed users in Firestore: [FirebaseError: Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore] {
  code: [32m'invalid-argument'[39m,
  customData: [90mundefined[39m,
  toString: [36m[Function (anonymous)][39m
}

[90mstdout[2m | tests/components/PatientRow.test.tsx
[22m[39m[useAuthState] ðŸ”” Auth State Change received: NULL
[useAuthState] ðŸ‘¤ Firebase user is NULL, checking offline fallback...
[useAuthState] ðŸ” Checking local storage for offline user...

[90mstderr[2m | tests/components/PatientRow.test.tsx
[22m[39m[authService] â€¼ï¸ Error checking allowed users in Firestore: [FirebaseError: Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore] {
  code: [32m'invalid-argument'[39m,
  customData: [90mundefined[39m,
  toString: [36m[Function (anonymous)][39m
}

[90mstdout[2m | tests/components/PatientRow.test.tsx
[22m[39m[useAuthState] ðŸ”” Auth State Change received: NULL
[useAuthState] ðŸ‘¤ Firebase user is NULL, checking offline fallback...
[useAuthState] ðŸ” Checking local storage for offline user...

 [32mâœ“[39m [30m[42m unit [49m[39m tests/components/PatientRow.test.tsx [2m([22m[2m16 tests[22m[2m)[22m[32m 271[2mms[22m[39m
[90mstdout[2m | hooks/useAuthState.ts:258:25
[22m[39m[useAuthState] âœ¨ Auth transition finished

[90mstdout[2m | hooks/useAuthState.ts:258:25
[22m[39m[useAuthState] âœ¨ Auth transition finished

[90mstdout[2m | hooks/useAuthState.ts:258:25
[22m[39m[useAuthState] âœ¨ Auth transition finished

[90mstdout[2m | hooks/useAuthState.ts:258:25
[22m[39m[useAuthState] âœ¨ Auth transition finished

[90mstdout[2m | hooks/useAuthState.ts:258:25
[22m[39m[useAuthState] âœ¨ Auth transition finished

[90mstdout[2m | hooks/useAuthState.ts:258:25
[22m[39m[useAuthState] âœ¨ Auth transition finished

[90mstdout[2m | hooks/useAuthState.ts:258:25
[22m[39m[useAuthState] âœ¨ Auth transition finished

[90mstdout[2m | hooks/useAuthState.ts:258:25
[22m[39m[useAuthState] âœ¨ Auth transition finished

[90mstdout[2m | hooks/useAuthState.ts:258:25
[22m[39m[useAuthState] âœ¨ Auth transition finished

[90mstdout[2m | hooks/useAuthState.ts:258:25
[22m[39m[useAuthState] âœ¨ Auth transition finished

[90mstdout[2m | hooks/useAuthState.ts:258:25
[22m[39m[useAuthState] âœ¨ Auth transition finished

[90mstdout[2m | hooks/useAuthState.ts:258:25
[22m[39m[useAuthState] âœ¨ Auth transition finished

[90mstdout[2m | hooks/useAuthState.ts:258:25
[22m[39m[useAuthState] âœ¨ Auth transition finished

[90mstdout[2m | hooks/useAuthState.ts:258:25
[22m[39m[useAuthState] âœ¨ Auth transition finished

[90mstdout[2m | hooks/useAuthState.ts:258:25
[22m[39m[useAuthState] âœ¨ Auth transition finished

 [32mâœ“[39m [30m[42m unit [49m[39m tests/integration/patientFlow.test.tsx [2m([22m[2m2 tests[22m[2m)[22m[33m 495[2mms[22m[39m
[90mstdout[2m | tests/integration/offline-persistence.test.ts
[22m[39mðŸ”„ Starting migration from localStorage to IndexedDB...

 [32mâœ“[39m [30m[42m unit [49m[39m tests/hooks/useAppState.test.ts [2m([22m[2m15 tests[22m[2m)[22m[32m 23[2mms[22m[39m
[90mstdout[2m | tests/integration/offline-persistence.test.ts[2m > [22m[2mOffline Persistence Integration[2m > [22m[2mshould save to localStorage even if Firestore fails
[22m[39mâœ… Migration complete!

 [32mâœ“[39m [30m[42m unit [49m[39m tests/hooks/useDailyRecordSyncQuery.test.tsx [2m([22m[2m2 tests[22m[2m)[22m[32m 126[2mms[22m[39m
[90mstderr[2m | tests/integration/offline-persistence.test.ts[2m > [22m[2mOffline Persistence Integration[2m > [22m[2mshould save to localStorage even if Firestore fails
[22m[39mFirestore sync failed, data saved in IndexedDB: Error: Network Failure
    at [90m/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mtests/integration/offline-persistence.test.ts:44:81
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:145:11
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:915:26
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1206:10[90m)[39m
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1650:37
    at Traces.$ [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
    at runTest [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1650:12[90m)[39m

 [32mâœ“[39m [30m[42m unit [49m[39m tests/integration/offline-persistence.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 18[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/components/Skeleton.test.tsx [2m([22m[2m16 tests[22m[2m)[22m[32m 163[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/hooks/useScrollLock.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 55[2mms[22m[39m
[90mstdout[2m | tests/hooks/useDailyRecordSync.test.ts[2m > [22m[2museDailyRecordSync - Reconnection Logic[2m > [22m[2mshould pull from Firestore if Online and NO local data exists
[22m[39m[Sync] Initializing Firestore subscription for: 2025-12-27
[useDailyRecordSync] Deep sync triggered for: 2025-12-27

[90mstdout[2m | tests/hooks/useDailyRecordSync.test.ts[2m > [22m[2museDailyRecordSync - Reconnection Logic[2m > [22m[2mshould pull from Firestore if Online and NO local data exists
[22m[39m[useDailyRecordSync] Firestore version is newer or local missing. Updating state.

[90mstdout[2m | tests/hooks/useDailyRecordSync.test.ts[2m > [22m[2museDailyRecordSync - Reconnection Logic[2m > [22m[2mshould NOT sync if navigator is offline
[22m[39m[Sync] Initializing Firestore subscription for: 2025-12-27

 [31mâ¯[39m [30m[42m unit [49m[39m tests/hooks/useDailyRecordSync.test.ts [2m([22m[2m3 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 1023[2mms[22m[39m
[31m     [31mÃ—[31m should push local data to Firestore if Online and isFirebaseConnected is true[39m[33m 1018[2mms[22m[39m
     [32mâœ“[39m should pull from Firestore if Online and NO local data exists[32m 2[2mms[22m[39m
     [32mâœ“[39m should NOT sync if navigator is offline[32m 2[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/services/featureFlags.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 47[2mms[22m[39m
[90mstdout[2m | tests/components/DeviceSelector.test.tsx
[22m[39mðŸ”„ Starting migration from localStorage to IndexedDB...

[90mstdout[2m | tests/components/DeviceSelector.test.tsx
[22m[39mâœ… Migration complete!

[90mstderr[2m | tests/utils/networkUtils.test.ts[2m > [22m[2mnetworkUtils[2m > [22m[2mshould retry on failure and eventually succeed
[22m[39m[networkUtils] Attempt 1 failed. Retrying in 10ms... Error: fail 1
    at [90m/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mtests/utils/networkUtils.test.ts:14:36
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:145:11
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:915:26
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1206:10[90m)[39m
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1650:37
    at Traces.$ [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
    at runTest [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1650:12[90m)[39m

 [32mâœ“[39m [30m[42m unit [49m[39m tests/components/DeviceSelector.test.tsx [2m([22m[2m5 tests[22m[2m)[22m[32m 107[2mms[22m[39m
[90mstderr[2m | tests/utils/networkUtils.test.ts[2m > [22m[2mnetworkUtils[2m > [22m[2mshould retry on failure and eventually succeed
[22m[39m[networkUtils] Attempt 2 failed. Retrying in 20ms... Error: fail 2
    at [90m/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mtests/utils/networkUtils.test.ts:15:36
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:145:11
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:915:26
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1206:10[90m)[39m
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1650:37
    at Traces.$ [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
    at runTest [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1650:12[90m)[39m

[90mstdout[2m | tests/hooks/useNurseManagement.test.ts[2m > [22m[2museNurseManagement[2m > [22m[2mupdateNurse[2m > [22m[2mshould send complete array when updating day shift nurse at index 0
[22m[39m[NurseManagement] updateNurse called: day [33m0[39m MarÃ­a LÃ³pez record: [33mtrue[39m
[NurseManagement] Sending complete array: nursesDayShift = [ [32m'MarÃ­a LÃ³pez'[39m, [32m''[39m ]

[90mstdout[2m | tests/hooks/useNurseManagement.test.ts[2m > [22m[2museNurseManagement[2m > [22m[2mupdateNurse[2m > [22m[2mshould send complete array when updating day shift nurse at index 1
[22m[39m[NurseManagement] updateNurse called: day [33m1[39m Juan PÃ©rez record: [33mtrue[39m
[NurseManagement] Sending complete array: nursesDayShift = [ [32m'MarÃ­a LÃ³pez'[39m, [32m'Juan PÃ©rez'[39m ]

[90mstdout[2m | tests/hooks/useNurseManagement.test.ts[2m > [22m[2museNurseManagement[2m > [22m[2mupdateNurse[2m > [22m[2mshould send complete array when updating night shift nurse
[22m[39m[NurseManagement] updateNurse called: night [33m1[39m Pedro Soto record: [33mtrue[39m
[NurseManagement] Sending complete array: nursesNightShift = [ [32m'Ana GarcÃ­a'[39m, [32m'Pedro Soto'[39m ]

[90mstdout[2m | tests/hooks/useNurseManagement.test.ts[2m > [22m[2museNurseManagement[2m > [22m[2mupdateNurse[2m > [22m[2mshould not call patchRecord if record is null
[22m[39m[NurseManagement] updateNurse called: day [33m0[39m Test Nurse record: [33mfalse[39m

[90mstderr[2m | tests/utils/networkUtils.test.ts[2m > [22m[2mnetworkUtils[2m > [22m[2mshould throw last error if all retries fail
[22m[39m[networkUtils] Attempt 1 failed. Retrying in 1ms... Error: final fail
    at [90m/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mtests/utils/networkUtils.test.ts:24:46
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:145:11
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:915:26
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1206:10[90m)[39m
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1650:37
    at Traces.$ [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
    at runTest [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1650:12[90m)[39m

[90mstdout[2m | tests/hooks/useNurseManagement.test.ts[2m > [22m[2museNurseManagement[2m > [22m[2mupdateNurse[2m > [22m[2mshould handle undefined nursesDayShift gracefully
[22m[39m[NurseManagement] updateNurse called: day [33m0[39m Test Nurse record: [33mtrue[39m
[NurseManagement] Sending complete array: nursesDayShift = [ [32m'Test Nurse'[39m, [32m''[39m ]

[90mstdout[2m | tests/hooks/useNurseManagement.test.ts[2m > [22m[2museNurseManagement[2m > [22m[2mupdateNurse[2m > [22m[2mshould preserve existing nurses when updating one slot
[22m[39m[NurseManagement] updateNurse called: day [33m0[39m New Nurse record: [33mtrue[39m
[NurseManagement] Sending complete array: nursesDayShift = [ [32m'New Nurse'[39m, [32m'Existing Nurse 2'[39m ]

[90mstderr[2m | tests/utils/networkUtils.test.ts[2m > [22m[2mnetworkUtils[2m > [22m[2mshould throw last error if all retries fail
[22m[39m[networkUtils] Attempt 2 failed. Retrying in 2ms... Error: final fail
    at [90m/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mtests/utils/networkUtils.test.ts:24:46
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:145:11
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:915:26
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1206:10[90m)[39m
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1650:37
    at Traces.$ [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
    at runTest [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1650:12[90m)[39m

[90mstdout[2m | tests/hooks/useNurseManagement.test.ts[2m > [22m[2museTensManagement[2m > [22m[2mupdateTens[2m > [22m[2mshould send complete array when updating day shift TENS at index 0
[22m[39m[TensManagement] Sending complete array: tensDayShift = [ [32m'Carlos FernÃ¡ndez'[39m, [32m''[39m, [32m''[39m ]

[90mstdout[2m | tests/hooks/useNurseManagement.test.ts[2m > [22m[2museTensManagement[2m > [22m[2mupdateTens[2m > [22m[2mshould send complete array when updating day shift TENS at index 2
[22m[39m[TensManagement] Sending complete array: tensDayShift = [ [32m'TENS 1'[39m, [32m'TENS 2'[39m, [32m'TENS 3'[39m ]

[90mstdout[2m | tests/hooks/useNurseManagement.test.ts[2m > [22m[2museTensManagement[2m > [22m[2mupdateTens[2m > [22m[2mshould send complete array when updating night shift TENS
[22m[39m[TensManagement] Sending complete array: tensNightShift = [ [32m'Night TENS 1'[39m, [32m'Night TENS 2'[39m, [32m''[39m ]

[90mstdout[2m | tests/hooks/useNurseManagement.test.ts[2m > [22m[2museTensManagement[2m > [22m[2mupdateTens[2m > [22m[2mshould handle undefined tensDayShift gracefully
[22m[39m[TensManagement] Sending complete array: tensDayShift = [ [32m'Test TENS'[39m, [32m''[39m, [32m''[39m ]

[90mstdout[2m | tests/hooks/useNurseManagement.test.ts[2m > [22m[2museTensManagement[2m > [22m[2mupdateTens[2m > [22m[2mshould preserve existing TENS when updating one slot
[22m[39m[TensManagement] Sending complete array: tensDayShift = [ [32m'TENS A'[39m, [32m'New TENS'[39m, [32m'TENS C'[39m ]

 [32mâœ“[39m [30m[42m unit [49m[39m tests/hooks/useNurseManagement.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 20[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/utils/networkUtils.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 46[2mms[22m[39m
[90mstderr[2m | tests/integration/firebaseSync.test.ts[2m > [22m[2mFirebase Sync Integration[2m > [22m[2mDailyRecord Sync[2m > [22m[2mshould include nurse and TENS fields when saving record
[22m[39mâŒ Failed to create history snapshot: TypeError: Cannot read properties of undefined (reading 'exists')
    at saveHistorySnapshot [90m(/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mservices/storage/firestoreService.ts:146:21[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at saveRecordToFirestore [90m(/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mservices/storage/firestoreService.ts:222:9[90m)[39m
    at [90m/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mtests/integration/firebaseSync.test.ts:72:13
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:915:20

[90mstdout[2m | tests/integration/firebaseSync.test.ts[2m > [22m[2mFirebase Sync Integration[2m > [22m[2mDailyRecord Sync[2m > [22m[2mshould include nurse and TENS fields when saving record
[22m[39mâœ… Saved to Firestore: 2025-12-13

[90mstdout[2m | tests/integration/handoff-signature.test.ts
[22m[39mðŸ”„ Starting migration from localStorage to IndexedDB...

[90mstderr[2m | tests/hooks/movementCounters.test.ts[2m > [22m[2mMovement Counters[2m > [22m[2mDischarge Counter (Altas)[2m > [22m[2mshould not add discharge for empty bed
[22m[39mAttempted to discharge empty bed: bed-3

[90mstdout[2m | tests/integration/handoff-signature.test.ts
[22m[39mâœ… Migration complete!

[90mstderr[2m | tests/hooks/movementCounters.test.ts[2m > [22m[2mMovement Counters[2m > [22m[2mTransfer Counter (Traslados)[2m > [22m[2mshould not add transfer for empty bed
[22m[39mAttempted to transfer empty bed: bed-3

 [32mâœ“[39m [30m[42m unit [49m[39m tests/integration/firebaseSync.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 50[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/hooks/movementCounters.test.ts [2m([22m[2m16 tests[22m[2m)[22m[32m 48[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/integration/handoff-signature.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 137[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/hooks/usePatientTransfers.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 35[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/components/NavbarTabs.test.tsx [2m([22m[2m7 tests[22m[2m)[22m[32m 126[2mms[22m[39m
[90mstdout[2m | tests/integration/flicker-free-login.test.tsx
[22m[39mðŸ”„ Starting migration from localStorage to IndexedDB...

[90mstdout[2m | tests/integration/flicker-free-login.test.tsx
[22m[39mâœ… Migration complete!

[90mstdout[2m | tests/integration/daily-record-sync.test.ts[2m > [22m[2mDailyRecord Sync Integration[2m > [22m[2mshould load local record on mount
[22m[39m[Sync] Initializing Firestore subscription for: 2024-12-28
[useDailyRecordSync] Deep sync triggered for: 2024-12-28

[90mstdout[2m | tests/integration/daily-record-sync.test.ts[2m > [22m[2mDailyRecord Sync Integration[2m > [22m[2mshould load local record on mount
[22m[39m[useDailyRecordSync] Local data found but no Firestore record. Pushing local to cloud.

[90mstdout[2m | tests/integration/daily-record-sync.test.ts[2m > [22m[2mDailyRecord Sync Integration[2m > [22m[2mshould subscribe to remote changes on mount
[22m[39m[Sync] Initializing Firestore subscription for: 2024-12-28
[useDailyRecordSync] Deep sync triggered for: 2024-12-28

[90mstdout[2m | tests/integration/daily-record-sync.test.ts[2m > [22m[2mDailyRecord Sync Integration[2m > [22m[2mshould update record when remote change is received (no local pending)
[22m[39m[Sync] Initializing Firestore subscription for: 2024-12-28
[useDailyRecordSync] Deep sync triggered for: 2024-12-28

[90mstdout[2m | tests/integration/daily-record-sync.test.ts[2m > [22m[2mDailyRecord Sync Integration[2m > [22m[2mshould update record when remote change is received (no local pending)
[22m[39m[Sync] Applying remote change, lastUpdated: 2024-12-28T13:00:00Z

[90mstdout[2m | tests/services/dailyRecordRepository.test.ts
[22m[39mðŸ”„ Starting migration from localStorage to IndexedDB...

[90mstdout[2m | tests/integration/daily-record-sync.test.ts[2m > [22m[2mDailyRecord Sync Integration[2m > [22m[2mshould save and update state on saveAndUpdate call
[22m[39m[Sync] Initializing Firestore subscription for: 2024-12-28
[useDailyRecordSync] Deep sync triggered for: 2024-12-28

[90mstdout[2m | tests/integration/daily-record-sync.test.ts[2m > [22m[2mDailyRecord Sync Integration[2m > [22m[2mshould perform patch update and keep state in sync
[22m[39m[Sync] Initializing Firestore subscription for: 2024-12-28
[useDailyRecordSync] Deep sync triggered for: 2024-12-28

[90mstdout[2m | tests/integration/daily-record-sync.test.ts[2m > [22m[2mDailyRecord Sync Integration[2m > [22m[2mshould perform patch update and keep state in sync
[22m[39m[useDailyRecordSync] Local data found but no Firestore record. Pushing local to cloud.

[90mstdout[2m | tests/services/dailyRecordRepository.test.ts[2m > [22m[2mDailyRecordRepository (Expanded)[2m > [22m[2mupdatePartial[2m > [22m[2mupdates local and remote data using dot notation
[22m[39mâœ… Migration complete!

[90mstdout[2m | tests/integration/daily-record-sync.test.ts[2m > [22m[2mDailyRecord Sync Integration[2m > [22m[2mshould handle save errors and update syncStatus
[22m[39m[Sync] Initializing Firestore subscription for: 2024-12-28
[useDailyRecordSync] Deep sync triggered for: 2024-12-28

[90mstderr[2m | tests/integration/daily-record-sync.test.ts[2m > [22m[2mDailyRecord Sync Integration[2m > [22m[2mshould handle save errors and update syncStatus
[22m[39mSave failed: Error: Firebase error
    at [90m/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mtests/integration/daily-record-sync.test.ts:195:36
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:145:11
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:915:26
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1206:10[90m)[39m
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1650:37
    at Traces.$ [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
    at runTest [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1650:12[90m)[39m

 [32mâœ“[39m [30m[42m unit [49m[39m tests/integration/daily-record-sync.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 43[2mms[22m[39m
[90mstderr[2m | tests/hooks/useHandoffLogic.test.ts[2m > [22m[2museHandoffLogic - Staff List Synchronization[2m > [22m[2mdeliversList - Census as Source of Truth[2m > [22m[2mshould return nursesNightShift when selectedShift is night
[22m[39mAn update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

[90mstderr[2m | tests/hooks/useHandoffLogic.test.ts[2m > [22m[2museHandoffLogic - Staff List Synchronization[2m > [22m[2mtensList - Census as Source of Truth[2m > [22m[2mshould return tensNightShift when selectedShift is night
[22m[39mAn update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

 [32mâœ“[39m [30m[42m unit [49m[39m tests/hooks/useHandoffLogic.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 56[2mms[22m[39m
[90mstdout[2m | tests/services/dailyRecordRepository.test.ts[2m > [22m[2mDailyRecordRepository (Expanded)[2m > [22m[2mupdatePartial[2m > [22m[2mupdates local and remote data using dot notation
[22m[39m[Repository] updatePartial called: 2024-12-28 [ [32m'beds.R1.patientName'[39m ]

[90mstdout[2m | tests/services/dailyRecordRepository.test.ts[2m > [22m[2mDailyRecordRepository (Expanded)[2m > [22m[2mupdatePartial[2m > [22m[2mupdates local and remote data using dot notation
[22m[39m[Repository] Sending partial update to Firestore: 2024-12-28

[90mstdout[2m | tests/services/dailyRecordRepository.test.ts[2m > [22m[2mDailyRecordRepository (Expanded)[2m > [22m[2mupdatePartial[2m > [22m[2msilently catches firestore errors to protect local data
[22m[39m[Repository] updatePartial called: 2024-12-28 [ [32m'nurses'[39m ]

[90mstdout[2m | tests/services/dailyRecordRepository.test.ts[2m > [22m[2mDailyRecordRepository (Expanded)[2m > [22m[2mupdatePartial[2m > [22m[2msilently catches firestore errors to protect local data
[22m[39m[Repository] Sending partial update to Firestore: 2024-12-28

[90mstderr[2m | tests/services/dailyRecordRepository.test.ts[2m > [22m[2mDailyRecordRepository (Expanded)[2m > [22m[2mupdatePartial[2m > [22m[2msilently catches firestore errors to protect local data
[22m[39mFirestore partial update failed: Error: Network Fail
    at [90m/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mtests/services/dailyRecordRepository.test.ts:77:83
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:145:11
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:915:26
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1206:10[90m)[39m
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1650:37
    at Traces.$ [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
    at runTest [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1650:12[90m)[39m

[90mstdout[2m | tests/services/firestoreService.test.ts[2m > [22m[2mfirestoreService[2m > [22m[2mshould save a record with integrity snapshot
[22m[39mðŸ“œ History snapshot created for 2024-12-24

[90mstdout[2m | tests/services/firestoreService.test.ts[2m > [22m[2mfirestoreService[2m > [22m[2mshould save a record with integrity snapshot
[22m[39mâœ… Saved to Firestore: 2024-12-24

[90mstdout[2m | tests/services/firestoreService.test.ts[2m > [22m[2mfirestoreService[2m > [22m[2mshould perform a partial update with snapshot
[22m[39mðŸ“œ History snapshot created for 2024-12-24

[90mstdout[2m | tests/services/firestoreService.test.ts[2m > [22m[2mfirestoreService[2m > [22m[2mshould perform a partial update with snapshot
[22m[39mâœ… Partial update to Firestore: 2024-12-24 [ [32m'beds.BED_01.patientName'[39m ]

[90mstdout[2m | tests/services/firestoreService.test.ts[2m > [22m[2mfirestoreService[2m > [22m[2mshould sanitize corrupted array data from Firestore (object with numeric keys)
[22m[39m[Firestore] Converted object to array: { [32m'0'[39m: [32m'Nurse A'[39m, [32m'1'[39m: [32m'Nurse B'[39m } -> [ [32m'Nurse A'[39m, [32m'Nurse B'[39m ]

[90mstdout[2m | tests/services/firestoreService.test.ts[2m > [22m[2mfirestoreService[2m > [22m[2mshould save nurse catalog to firestore
[22m[39mâœ… Nurse catalog saved to Firestore

[90mstdout[2m | tests/services/firestoreService.test.ts[2m > [22m[2mfirestoreService[2m > [22m[2mshould handle catalog subscriptions correctly
[22m[39m[Firestore] Setting up nurse catalog subscription...
[Firestore] Nurse catalog snapshot received, exists: [33mtrue[39m
[Firestore] Nurse catalog data: [ [32m'Staff 1'[39m ]

[90mstdout[2m | tests/services/firestoreService.test.ts[2m > [22m[2mfirestoreService[2m > [22m[2mshould save TENS catalog to firestore
[22m[39mâœ… TENS catalog saved to Firestore

[90mstderr[2m | tests/services/firestoreService.test.ts[2m > [22m[2mfirestoreService[2m > [22m[2mshould handle catalog fetch errors gracefully
[22m[39mError fetching nurse catalog from Firestore: Error: Firestore error
    at [90m/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mtests/services/firestoreService.test.ts:209:38
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:145:11
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:915:26
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1206:10[90m)[39m
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1650:37
    at Traces.$ [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
    at runTest [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1650:12[90m)[39m

[90mstdout[2m | tests/services/firestoreService.test.ts[2m > [22m[2mfirestoreService[2m > [22m[2mshould handle subscription errors
[22m[39m[Firestore] Setting up nurse catalog subscription...

[90mstderr[2m | tests/services/firestoreService.test.ts[2m > [22m[2mfirestoreService[2m > [22m[2mshould handle subscription errors
[22m[39mâŒ Error subscribing to nurse catalog: Error: Sub error
    at [90m/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mtests/services/firestoreService.test.ts:230:34
    at Mock [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/spy/dist/index.js:285:34[90m)[39m
    at subscribeToNurseCatalog [90m(/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mservices/storage/firestoreService.ts:431:12[90m)[39m
    at [90m/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mtests/services/firestoreService.test.ts:235:9
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:915:20

 [32mâœ“[39m [30m[42m unit [49m[39m tests/services/firestoreService.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 15[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/services/dailyRecordRepository.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 205[2mms[22m[39m
[90mstdout[2m | tests/hooks/useModal.test.ts
[22m[39mðŸ”„ Starting migration from localStorage to IndexedDB...

[90mstdout[2m | tests/hooks/useModal.test.ts
[22m[39mâœ… Migration complete!

 [32mâœ“[39m [30m[42m unit [49m[39m tests/components/DemoModeBadge.test.tsx [2m([22m[2m3 tests[22m[2m)[22m[32m 136[2mms[22m[39m
[90mstdout[2m | tests/services/authService.test.ts[2m > [22m[2mauthService[2m > [22m[2msignIn[2m > [22m[2mshould allow access if user is in whitelist
[22m[39m[authService] ðŸ” Checking whitelist for: daniel.opazo@hospitalhangaroa.cl

[90mstdout[2m | tests/services/authService.test.ts[2m > [22m[2mauthService[2m > [22m[2msignIn[2m > [22m[2mshould allow access if user is in whitelist
[22m[39m[authService] âœ… Access granted via static rule: daniel.opazo@hospitalhangaroa.cl -> admin

[90mstdout[2m | tests/services/authService.test.ts[2m > [22m[2mauthService[2m > [22m[2msignIn[2m > [22m[2mshould deny access and sign out if user is not in whitelist
[22m[39m[authService] ðŸ” Checking whitelist for: unknown@gmail.com

[90mstdout[2m | tests/services/authService.test.ts[2m > [22m[2mauthService[2m > [22m[2msignIn[2m > [22m[2mshould deny access and sign out if user is not in whitelist
[22m[39m[authService] ðŸ“¡ Querying Firestore for whitelist...

[90mstderr[2m | tests/services/authService.test.ts[2m > [22m[2mauthService[2m > [22m[2msignIn[2m > [22m[2mshould deny access and sign out if user is not in whitelist
[22m[39m[authService] âŒ Email not found in whitelist: unknown@gmail.com

[90mstdout[2m | tests/services/authService.test.ts[2m > [22m[2mauthService[2m > [22m[2msignIn[2m > [22m[2mshould deny access and sign out if user is not in whitelist
[22m[39m[authService] ðŸ“¥ Firestore response received. Empty: true

[90mstdout[2m | tests/services/authService.test.ts[2m > [22m[2mauthService[2m > [22m[2msignIn[2m > [22m[2mshould normalize emails during check
[22m[39m[authService] ðŸ” Checking whitelist for: DANIEL.OPAZO@HOSPITALHANGAROA.CL 

[90mstdout[2m | tests/services/authService.test.ts[2m > [22m[2mauthService[2m > [22m[2msignIn[2m > [22m[2mshould normalize emails during check
[22m[39m[authService] âš¡ Role recovered from cache: admin

[90mstdout[2m | tests/services/authService.test.ts[2m > [22m[2mauthService[2m > [22m[2msignInWithGoogle[2m > [22m[2mshould succeed for authorized users
[22m[39m[authService] ðŸ” Checking whitelist for: d.opazo.damiani@gmail.com

[90mstdout[2m | tests/services/authService.test.ts[2m > [22m[2mauthService[2m > [22m[2msignInWithGoogle[2m > [22m[2mshould succeed for authorized users
[22m[39m[authService] âœ… Access granted via static rule: d.opazo.damiani@gmail.com -> doctor_urgency

[90mstdout[2m | tests/services/authService.test.ts[2m > [22m[2mauthService[2m > [22m[2monAuthChange[2m > [22m[2mshould handle anonymous users for signature mode
[22m[39m[authService] ðŸŽ§ Setting up onAuthStateChanged observer
[authService] ðŸ‘¤ Firebase onAuthStateChanged triggered. User: Anonymous

 [32mâœ“[39m [30m[42m unit [49m[39m tests/services/authService.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 46[2mms[22m[39m
[90mstderr[2m | tests/hooks/useBedManagement.test.ts[2m > [22m[2museBedManagement[2m > [22m[2mupdatePatient[2m > [22m[2mshould not update admissionDate to future date
[22m[39mValidation failed for admissionDate: La fecha de ingreso no puede ser futura

 [32mâœ“[39m [30m[42m unit [49m[39m tests/hooks/useBedManagement.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 56[2mms[22m[39m
[90mstderr[2m | tests/integration/flicker-free-login.test.tsx[2m > [22m[2mFlicker-Free Login Flow[2m > [22m[2mshould transition smoothly without window.location.reload when login succeeds
[22m[39mError: useUI must be used within a UIProvider
    at useUI [90m(/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mcontext/UIContext.tsx:71:15[90m)[39m
    at useDailyRecord [90m(/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mhooks/useDailyRecord.ts:58:34[90m)[39m
    at AppInner [90m(/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mApp.tsx:98:27[90m)[39m
    at Object.react_stack_bottom_frame [90m(/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4mreact-dom[24m/cjs/react-dom-client.development.js:25904:20[90m)[39m
    at renderWithHooks [90m(/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4mreact-dom[24m/cjs/react-dom-client.development.js:7662:22[90m)[39m
    at updateFunctionComponent [90m(/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4mreact-dom[24m/cjs/react-dom-client.development.js:10166:19[90m)[39m
    at beginWork [90m(/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4mreact-dom[24m/cjs/react-dom-client.development.js:11778:18[90m)[39m
    at runWithFiberInDEV [90m(/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4mreact-dom[24m/cjs/react-dom-client.development.js:874:13[90m)[39m
    at performUnitOfWork [90m(/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4mreact-dom[24m/cjs/react-dom-client.development.js:17641:22[90m)[39m
    at workLoopSync [90m(/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4mreact-dom[24m/cjs/react-dom-client.development.js:17469:41[90m)[39m
    at renderRootSync [90m(/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4mreact-dom[24m/cjs/react-dom-client.development.js:17450:11[90m)[39m
    at performWorkOnRoot [90m(/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4mreact-dom[24m/cjs/react-dom-client.development.js:16583:35[90m)[39m
    at performWorkOnRootViaSchedulerTask [90m(/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4mreact-dom[24m/cjs/react-dom-client.development.js:18957:7[90m)[39m
    at flushActQueue [90m(/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4mreact[24m/cjs/react.development.js:590:34[90m)[39m
    at process.env.NODE_ENV.exports.act [90m(/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4mreact[24m/cjs/react.development.js:884:10[90m)[39m
    at [90m/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@testing-library[24m/react/dist/act-compat.js:47:25 {
  [stack]: [36m[Getter/Setter][39m,
  [message]: [32m'useUI must be used within a UIProvider'[39m
}

The above error occurred in the <AppInner> component.

React will try to recreate this component tree from scratch using the error boundary you provided, GlobalErrorBoundary.

[ErrorService] {
  id: [32m'err_1767061073786_ofqqp5gjl'[39m,
  timestamp: [32m'2025-12-30T02:17:53.786Z'[39m,
  message: [32m'React Error Boundary: useUI must be used within a UIProvider'[39m,
  severity: [32m'critical'[39m,
  stack: [32m'\n'[39m +
    [32m'    at AppInner (/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/App.tsx:60:21)\n'[39m +
    [32m'    at AuditProvider (/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/tests/setup.ts:58:21)\n'[39m +
    [32m'    at App (/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/App.tsx:26:48)\n'[39m +
    [32m'    at GlobalErrorBoundary (/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/components/shared/GlobalErrorBoundary.tsx:9:5)\n'[39m +
    [32m'    at AppWithErrorBoundary (<anonymous>)'[39m,
  userId: [90mundefined[39m,
  userEmail: [90mundefined[39m,
  context: {
    componentStack: [32m'\n'[39m +
      [32m'    at AppInner (/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/App.tsx:60:21)\n'[39m +
      [32m'    at AuditProvider (/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/tests/setup.ts:58:21)\n'[39m +
      [32m'    at App (/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/App.tsx:26:48)\n'[39m +
      [32m'    at GlobalErrorBoundary (/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/components/shared/GlobalErrorBoundary.tsx:9:5)\n'[39m +
      [32m'    at AppWithErrorBoundary (<anonymous>)'[39m,
    errorInfo: {
      componentStack: [32m'\n'[39m +
        [32m'    at AppInner (/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/App.tsx:60:21)\n'[39m +
        [32m'    at AuditProvider (/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/tests/setup.ts:58:21)\n'[39m +
        [32m'    at App (/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/App.tsx:26:48)\n'[39m +
        [32m'    at GlobalErrorBoundary (/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/components/shared/GlobalErrorBoundary.tsx:9:5)\n'[39m +
        [32m'    at AppWithErrorBoundary (<anonymous>)'[39m
    }
  },
  userAgent: [32m'Mozilla/5.0 (darwin) AppleWebKit/537.36 (KHTML, like Gecko) jsdom/27.3.0'[39m,
  url: [90mundefined[39m
}

 [32mâœ“[39m [30m[42m unit [49m[39m tests/integration/flicker-free-login.test.tsx [2m([22m[2m1 test[22m[2m)[22m[32m 57[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/hooks/useModal.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 46[2mms[22m[39m
[90mstdout[2m | tests/integration/census-email.test.ts
[22m[39mðŸ”„ Starting migration from localStorage to IndexedDB...

[90mstdout[2m | tests/integration/census-email.test.ts
[22m[39mâœ… Migration complete!

 [32mâœ“[39m [30m[42m unit [49m[39m tests/hooks/usePatientValidation.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 42[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/hooks/useBedOperations.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 110[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/integration/census-export.test.ts [2m([22m[2m15 tests[22m[2m)[22m[32m 48[2mms[22m[39m
[90mstderr[2m | tests/integration/concurrency.test.ts[2m > [22m[2mConcurrency Handling Integration[2m > [22m[2mshould handle ConcurrencyError correctly
[22m[39mSave failed: ConcurrencyError: Remote is newer
    at [90m/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mtests/integration/concurrency.test.ts:54:36
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:145:11
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:915:26
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1206:10[90m)[39m
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1650:37
    at Traces.$ [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
    at runTest [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1650:12[90m)[39m

 [32mâœ“[39m [30m[42m unit [49m[39m tests/integration/concurrency.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 24[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/utils/dateUtils.test.ts [2m([22m[2m21 tests[22m[2m)[22m[32m 18[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/integration/census-email.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 16[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/hooks/undoOperations.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 18[2mms[22m[39m
[90mstderr[2m | tests/services/tableConfigService.test.ts[2m > [22m[2mtableConfigService[2m > [22m[2mloadTableConfig[2m > [22m[2mshould handle errors by returning default config
[22m[39mError loading table config: Error: Firestore error
    at [90m/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mtests/services/tableConfigService.test.ts:68:49
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:145:11
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:915:26
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1206:10[90m)[39m
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1650:37
    at Traces.$ [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
    at runTest [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1650:12[90m)[39m

 [32mâœ“[39m [30m[42m unit [49m[39m tests/services/tableConfigService.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 16[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/services/censusEmailService.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 20[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/hooks/useClinicalCrib.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 40[2mms[22m[39m
[90mstdout[2m | tests/hooks/useSignatureMode.test.ts[2m > [22m[2museSignatureMode[2m > [22m[2mshould sign in anonymously if in signature mode and no user is present
[22m[39m[useSignatureMode] ðŸ‘¤ No user found in signature mode, signing in anonymously...

 [32mâœ“[39m [30m[42m unit [49m[39m tests/hooks/useSignatureMode.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 25[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/services/localStorageService.test.ts [2m([22m[2m22 tests[22m[2m)[22m[32m 29[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/integration/censusOperations.test.ts [2m([22m[2m13 tests[22m[2m)[22m[32m 19[2mms[22m[39m
[90mstderr[2m | tests/validation/schema-fuzzing.test.ts[2m > [22m[2mData Schema Resilience (Fuzzing)[2m > [22m[2mshould fail gracefully on totally corrupted data
[22m[39mâš ï¸ DailyRecord validation failed: [
  {
    code: [32m'invalid_type'[39m,
    expected: [32m'string'[39m,
    received: [32m'number'[39m,
    path: [ [32m'date'[39m ],
    message: [32m'Expected string, received number'[39m
  },
  {
    code: [32m'invalid_type'[39m,
    expected: [32m'object'[39m,
    received: [32m'string'[39m,
    path: [ [32m'beds'[39m ],
    message: [32m'Expected object, received string'[39m
  },
  {
    code: [32m'invalid_type'[39m,
    expected: [32m'array'[39m,
    received: [32m'null'[39m,
    path: [ [32m'discharges'[39m ],
    message: [32m'Expected array, received null'[39m
  }
]

[90mstderr[2m | tests/validation/schema-fuzzing.test.ts[2m > [22m[2mData Schema Resilience (Fuzzing)[2m > [22m[2mshould recover basic structure using parseDailyRecordWithDefaults
[22m[39mâš ï¸ Applying defaults to DailyRecord for date: 2024-12-25

[90mstderr[2m | tests/validation/schema-fuzzing.test.ts[2m > [22m[2mData Schema Resilience (Fuzzing)[2m > [22m[2mshould handle unexpected enum values in PatientData
[22m[39mâš ï¸ DailyRecord validation failed: [
  {
    received: [32m'ROBOT'[39m,
    code: [32m'invalid_enum_value'[39m,
    options: [ [32m'Masculino'[39m, [32m'Femenino'[39m, [32m'Indeterminado'[39m ],
    path: [ [32m'beds'[39m, [32m'BED_01'[39m, [32m'biologicalSex'[39m ],
    message: [32m"Invalid enum value. Expected 'Masculino' | 'Femenino' | 'Indeterminado', received 'ROBOT'"[39m
  },
  {
    received: [32m'SUPER_GRAVE'[39m,
    code: [32m'invalid_enum_value'[39m,
    options: [ [32m'Grave'[39m, [32m'De cuidado'[39m, [32m'Estable'[39m, [32m''[39m ],
    path: [ [32m'beds'[39m, [32m'BED_01'[39m, [32m'status'[39m ],
    message: [32m"Invalid enum value. Expected 'Grave' | 'De cuidado' | 'Estable' | '', received 'SUPER_GRAVE'"[39m
  }
]

 [32mâœ“[39m [30m[42m unit [49m[39m tests/validation/schema-fuzzing.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 10[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/services/auditServiceCoverage.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 9[2mms[22m[39m
[90mstdout[2m | tests/utils/optimisticUpdates.test.ts
[22m[39mðŸ”„ Starting migration from localStorage to IndexedDB...

[90mstdout[2m | tests/utils/optimisticUpdates.test.ts
[22m[39mâœ… Migration complete!

 [32mâœ“[39m [30m[42m unit [49m[39m tests/services/ensureArray.test.ts [2m([22m[2m15 tests[22m[2m)[22m[32m 7[2mms[22m[39m
[90mstdout[2m | tests/services/auditService.test.ts[2m > [22m[2mAuditService[2m > [22m[2mshould store audit logs via indexedDBService
[22m[39mðŸ“‹ Audit log saved: PATIENT_ADMITTED BED_01

[90mstdout[2m | tests/services/auditService.test.ts[2m > [22m[2mAuditService[2m > [22m[2mshould attempt saving to firestore
[22m[39mðŸ“‹ Audit log saved: USER_LOGIN tester@hospital.cl

 [32mâœ“[39m [30m[42m unit [49m[39m tests/services/auditService.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 6[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/services/loggerService.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 8[2mms[22m[39m
[90mstdout[2m | tests/utils/optimisticUpdates.test.ts[2m > [22m[2mOptimisticUpdates[2m > [22m[2mperformOptimisticUpdate[2m > [22m[2mshould apply optimistic update immediately
[22m[39m[02:17:55.759] [DEBUG] [OptimisticUpdate] Update successful 

[90mstdout[2m | tests/utils/optimisticUpdates.test.ts[2m > [22m[2mOptimisticUpdates[2m > [22m[2mperformOptimisticUpdate[2m > [22m[2mshould accept function for optimistic state
[22m[39m[02:17:55.762] [DEBUG] [OptimisticUpdate] Update successful 

[90mstderr[2m | tests/utils/optimisticUpdates.test.ts[2m > [22m[2mOptimisticUpdates[2m > [22m[2mperformOptimisticUpdate[2m > [22m[2mshould rollback on error
[22m[39m[02:17:55.763] [WARN] [OptimisticUpdate] Rolling back due to error Error: Network error
    at [90m/Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mtests/utils/optimisticUpdates.test.ts:46:56
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:145:11
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:915:26
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1206:10[90m)[39m
    at [90mfile:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1650:37
    at Traces.$ [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
    at runTest [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1650:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1814:8[90m)[39m
    at runSuite [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1814:8[90m)[39m
    at runSuite [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1814:8[90m)[39m
    at runFiles [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1894:3[90m)[39m
    at startTests [90m(file:///Users/danielopazodamiani/Downloads/HHRGithub20Dic-main/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1937:3[90m)[39m

[90mstdout[2m | tests/utils/optimisticUpdates.test.ts[2m > [22m[2mOptimisticUpdates[2m > [22m[2mperformOptimisticUpdate[2m > [22m[2mshould return success true on successful update
[22m[39m[02:17:55.767] [DEBUG] [OptimisticUpdate] Update successful 

[90mstdout[2m | tests/utils/optimisticUpdates.test.ts[2m > [22m[2mOptimisticUpdates[2m > [22m[2mperformOptimisticUpdate[2m > [22m[2mshould call onSuccess callback when provided
[22m[39m[02:17:55.768] [DEBUG] [OptimisticUpdate] Update successful 

 [32mâœ“[39m [30m[42m unit [49m[39m tests/utils/optimisticUpdates.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 11[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/integration/pwaOffline.test.ts [2m([22m[2m13 tests[22m[2m)[22m[32m 4[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/utils/permissions.test.ts [2m([22m[2m17 tests[22m[2m)[22m[32m 5[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/services/statsCalculator.test.ts [2m([22m[2m13 tests[22m[2m)[22m[32m 7[2mms[22m[39m
[90mstdout[2m | tests/integration/audit-flow.test.ts[2m > [22m[2mAudit Flow Integration[2m > [22m[2mshould log patient admission locally and to Firestore
[22m[39mðŸ“‹ Audit log saved: PATIENT_ADMITTED BED_01

[90mstdout[2m | tests/integration/audit-flow.test.ts[2m > [22m[2mAudit Flow Integration[2m > [22m[2mshould log patient discharge with correct details
[22m[39mðŸ“‹ Audit log saved: PATIENT_DISCHARGED BED_02

[90mstdout[2m | tests/integration/audit-flow.test.ts[2m > [22m[2mAudit Flow Integration[2m > [22m[2mshould log patient view for regular users
[22m[39mðŸ“‹ Audit log saved: PATIENT_VIEWED BED_01

 [32mâœ“[39m [30m[42m unit [49m[39m tests/integration/audit-flow.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 3[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/integration/permissions.test.ts [2m([22m[2m15 tests[22m[2m)[22m[32m 9[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/integration/cudyrScoring.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 3[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/services/admin/attributionService.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 11[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/hooks/bedOperations.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 5[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/components/DeviceMenu.test.tsx [2m([22m[2m7 tests[22m[2m)[22m[32m 25[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/hooks/copyPreviousDay.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 6[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/utils/patchUtils.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 5[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/services/dataService.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 3[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/integrations/fhir/fhirMapping.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 6[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/hooks/usePatientDischarges.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 10[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/utils/cudyrScoreUtils.test.ts [2m([22m[2m17 tests[22m[2m)[22m[32m 9[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/auth/passportAuth.test.ts [2m([22m[2m13 tests[22m[2m)[22m[32m 3[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/utils/rutUtils.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 3[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/constants/email.test.ts [2m([22m[2m15 tests[22m[2m)[22m[32m 3[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/validation/admissionDates.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 2[2mms[22m[39m
 [32mâœ“[39m [30m[42m unit [49m[39m tests/services/storage/indexedDBService.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 2[2mms[22m[39m

[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m[1m[41m Failed Tests 10 [49m[22m[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m

[41m[1m FAIL [22m[49m [30m[42m unit [49m[39m tests/hooks/useDailyRecord.test.ts[2m > [22museDailyRecord[2m > [22mshould initialize with record for the given date
[31m[1mError[22m: No QueryClient set, use QueryClientProvider to set one[39m
[90m [2mâ¯[22m useQueryClient node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:[2m15:11[22m[39m
[36m [2mâ¯[22m useDailyRecordSyncQuery hooks/useDailyRecordSyncQuery.ts:[2m19:25[22m[39m
    [90m 17| [39m    _isFirebaseConnected[33m:[39m boolean [33m=[39m [35mfalse[39m
    [90m 18| [39m)[33m:[39m [33mUseDailyRecordSyncResult[39m [33m=>[39m {
    [90m 19| [39m    [35mconst[39m queryClient [33m=[39m [34museQueryClient[39m()[33m;[39m
    [90m   | [39m                        [31m^[39m
    [90m 20| [39m
    [90m 21| [39m    [90m// 1. Fetching[39m
[90m [2mâ¯[22m Module.useDailyRecord hooks/useDailyRecord.ts:[2m72:9[22m[39m
[90m [2mâ¯[22m tests/hooks/useDailyRecord.test.ts:[2m52:45[22m[39m
[90m [2mâ¯[22m TestComponent node_modules/@testing-library/react/dist/pure.js:[2m331:27[22m[39m
[90m [2mâ¯[22m Object.react_stack_bottom_frame node_modules/react-dom/cjs/react-dom-client.development.js:[2m25904:20[22m[39m
[90m [2mâ¯[22m renderWithHooks node_modules/react-dom/cjs/react-dom-client.development.js:[2m7662:22[22m[39m
[90m [2mâ¯[22m updateFunctionComponent node_modules/react-dom/cjs/react-dom-client.development.js:[2m10166:19[22m[39m
[90m [2mâ¯[22m beginWork node_modules/react-dom/cjs/react-dom-client.development.js:[2m11778:18[22m[39m
[90m [2mâ¯[22m runWithFiberInDEV node_modules/react-dom/cjs/react-dom-client.development.js:[2m874:13[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[1/10]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m [30m[42m unit [49m[39m tests/hooks/useDailyRecord.test.ts[2m > [22museDailyRecord[2m > [22mshould subscribe to updates on mount
[31m[1mError[22m: No QueryClient set, use QueryClientProvider to set one[39m
[90m [2mâ¯[22m useQueryClient node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:[2m15:11[22m[39m
[36m [2mâ¯[22m useDailyRecordSyncQuery hooks/useDailyRecordSyncQuery.ts:[2m19:25[22m[39m
    [90m 17| [39m    _isFirebaseConnected[33m:[39m boolean [33m=[39m [35mfalse[39m
    [90m 18| [39m)[33m:[39m [33mUseDailyRecordSyncResult[39m [33m=>[39m {
    [90m 19| [39m    [35mconst[39m queryClient [33m=[39m [34museQueryClient[39m()[33m;[39m
    [90m   | [39m                        [31m^[39m
    [90m 20| [39m
    [90m 21| [39m    [90m// 1. Fetching[39m
[90m [2mâ¯[22m Module.useDailyRecord hooks/useDailyRecord.ts:[2m72:9[22m[39m
[90m [2mâ¯[22m tests/hooks/useDailyRecord.test.ts:[2m61:26[22m[39m
[90m [2mâ¯[22m TestComponent node_modules/@testing-library/react/dist/pure.js:[2m331:27[22m[39m
[90m [2mâ¯[22m Object.react_stack_bottom_frame node_modules/react-dom/cjs/react-dom-client.development.js:[2m25904:20[22m[39m
[90m [2mâ¯[22m renderWithHooks node_modules/react-dom/cjs/react-dom-client.development.js:[2m7662:22[22m[39m
[90m [2mâ¯[22m updateFunctionComponent node_modules/react-dom/cjs/react-dom-client.development.js:[2m10166:19[22m[39m
[90m [2mâ¯[22m beginWork node_modules/react-dom/cjs/react-dom-client.development.js:[2m11778:18[22m[39m
[90m [2mâ¯[22m runWithFiberInDEV node_modules/react-dom/cjs/react-dom-client.development.js:[2m874:13[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[2/10]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m [30m[42m unit [49m[39m tests/hooks/useDailyRecord.test.ts[2m > [22museDailyRecord[2m > [22mshould update record when date changes
[31m[1mError[22m: No QueryClient set, use QueryClientProvider to set one[39m
[90m [2mâ¯[22m useQueryClient node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:[2m15:11[22m[39m
[36m [2mâ¯[22m useDailyRecordSyncQuery hooks/useDailyRecordSyncQuery.ts:[2m19:25[22m[39m
    [90m 17| [39m    _isFirebaseConnected[33m:[39m boolean [33m=[39m [35mfalse[39m
    [90m 18| [39m)[33m:[39m [33mUseDailyRecordSyncResult[39m [33m=>[39m {
    [90m 19| [39m    [35mconst[39m queryClient [33m=[39m [34museQueryClient[39m()[33m;[39m
    [90m   | [39m                        [31m^[39m
    [90m 20| [39m
    [90m 21| [39m    [90m// 1. Fetching[39m
[90m [2mâ¯[22m Module.useDailyRecord hooks/useDailyRecord.ts:[2m72:9[22m[39m
[90m [2mâ¯[22m __vi_import_0__.renderHook.initialProps.date tests/hooks/useDailyRecord.test.ts:[2m68:55[22m[39m
[90m [2mâ¯[22m TestComponent node_modules/@testing-library/react/dist/pure.js:[2m331:27[22m[39m
[90m [2mâ¯[22m Object.react_stack_bottom_frame node_modules/react-dom/cjs/react-dom-client.development.js:[2m25904:20[22m[39m
[90m [2mâ¯[22m renderWithHooks node_modules/react-dom/cjs/react-dom-client.development.js:[2m7662:22[22m[39m
[90m [2mâ¯[22m updateFunctionComponent node_modules/react-dom/cjs/react-dom-client.development.js:[2m10166:19[22m[39m
[90m [2mâ¯[22m beginWork node_modules/react-dom/cjs/react-dom-client.development.js:[2m11778:18[22m[39m
[90m [2mâ¯[22m runWithFiberInDEV node_modules/react-dom/cjs/react-dom-client.development.js:[2m874:13[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[3/10]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m [30m[42m unit [49m[39m tests/hooks/useDailyRecord.test.ts[2m > [22museDailyRecord[2m > [22mshould handle remote updates correctly
[31m[1mError[22m: No QueryClient set, use QueryClientProvider to set one[39m
[90m [2mâ¯[22m useQueryClient node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:[2m15:11[22m[39m
[36m [2mâ¯[22m useDailyRecordSyncQuery hooks/useDailyRecordSyncQuery.ts:[2m19:25[22m[39m
    [90m 17| [39m    _isFirebaseConnected[33m:[39m boolean [33m=[39m [35mfalse[39m
    [90m 18| [39m)[33m:[39m [33mUseDailyRecordSyncResult[39m [33m=>[39m {
    [90m 19| [39m    [35mconst[39m queryClient [33m=[39m [34museQueryClient[39m()[33m;[39m
    [90m   | [39m                        [31m^[39m
    [90m 20| [39m
    [90m 21| [39m    [90m// 1. Fetching[39m
[90m [2mâ¯[22m Module.useDailyRecord hooks/useDailyRecord.ts:[2m72:9[22m[39m
[90m [2mâ¯[22m tests/hooks/useDailyRecord.test.ts:[2m94:45[22m[39m
[90m [2mâ¯[22m TestComponent node_modules/@testing-library/react/dist/pure.js:[2m331:27[22m[39m
[90m [2mâ¯[22m Object.react_stack_bottom_frame node_modules/react-dom/cjs/react-dom-client.development.js:[2m25904:20[22m[39m
[90m [2mâ¯[22m renderWithHooks node_modules/react-dom/cjs/react-dom-client.development.js:[2m7662:22[22m[39m
[90m [2mâ¯[22m updateFunctionComponent node_modules/react-dom/cjs/react-dom-client.development.js:[2m10166:19[22m[39m
[90m [2mâ¯[22m beginWork node_modules/react-dom/cjs/react-dom-client.development.js:[2m11778:18[22m[39m
[90m [2mâ¯[22m runWithFiberInDEV node_modules/react-dom/cjs/react-dom-client.development.js:[2m874:13[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[4/10]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m [30m[42m unit [49m[39m tests/hooks/useDailyRecord.test.ts[2m > [22museDailyRecord[2m > [22mshould create a new day
[31m[1mError[22m: No QueryClient set, use QueryClientProvider to set one[39m
[90m [2mâ¯[22m useQueryClient node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:[2m15:11[22m[39m
[36m [2mâ¯[22m useDailyRecordSyncQuery hooks/useDailyRecordSyncQuery.ts:[2m19:25[22m[39m
    [90m 17| [39m    _isFirebaseConnected[33m:[39m boolean [33m=[39m [35mfalse[39m
    [90m 18| [39m)[33m:[39m [33mUseDailyRecordSyncResult[39m [33m=>[39m {
    [90m 19| [39m    [35mconst[39m queryClient [33m=[39m [34museQueryClient[39m()[33m;[39m
    [90m   | [39m                        [31m^[39m
    [90m 20| [39m
    [90m 21| [39m    [90m// 1. Fetching[39m
[90m [2mâ¯[22m Module.useDailyRecord hooks/useDailyRecord.ts:[2m72:9[22m[39m
[90m [2mâ¯[22m tests/hooks/useDailyRecord.test.ts:[2m115:45[22m[39m
[90m [2mâ¯[22m TestComponent node_modules/@testing-library/react/dist/pure.js:[2m331:27[22m[39m
[90m [2mâ¯[22m Object.react_stack_bottom_frame node_modules/react-dom/cjs/react-dom-client.development.js:[2m25904:20[22m[39m
[90m [2mâ¯[22m renderWithHooks node_modules/react-dom/cjs/react-dom-client.development.js:[2m7662:22[22m[39m
[90m [2mâ¯[22m updateFunctionComponent node_modules/react-dom/cjs/react-dom-client.development.js:[2m10166:19[22m[39m
[90m [2mâ¯[22m beginWork node_modules/react-dom/cjs/react-dom-client.development.js:[2m11778:18[22m[39m
[90m [2mâ¯[22m runWithFiberInDEV node_modules/react-dom/cjs/react-dom-client.development.js:[2m874:13[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[5/10]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m [30m[42m unit [49m[39m tests/hooks/useDailyRecord.test.ts[2m > [22museDailyRecord[2m > [22mshould not move patient if source bed is empty
[31m[1mError[22m: No QueryClient set, use QueryClientProvider to set one[39m
[90m [2mâ¯[22m useQueryClient node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:[2m15:11[22m[39m
[36m [2mâ¯[22m useDailyRecordSyncQuery hooks/useDailyRecordSyncQuery.ts:[2m19:25[22m[39m
    [90m 17| [39m    _isFirebaseConnected[33m:[39m boolean [33m=[39m [35mfalse[39m
    [90m 18| [39m)[33m:[39m [33mUseDailyRecordSyncResult[39m [33m=>[39m {
    [90m 19| [39m    [35mconst[39m queryClient [33m=[39m [34museQueryClient[39m()[33m;[39m
    [90m   | [39m                        [31m^[39m
    [90m 20| [39m
    [90m 21| [39m    [90m// 1. Fetching[39m
[90m [2mâ¯[22m Module.useDailyRecord hooks/useDailyRecord.ts:[2m72:9[22m[39m
[90m [2mâ¯[22m tests/hooks/useDailyRecord.test.ts:[2m138:45[22m[39m
[90m [2mâ¯[22m TestComponent node_modules/@testing-library/react/dist/pure.js:[2m331:27[22m[39m
[90m [2mâ¯[22m Object.react_stack_bottom_frame node_modules/react-dom/cjs/react-dom-client.development.js:[2m25904:20[22m[39m
[90m [2mâ¯[22m renderWithHooks node_modules/react-dom/cjs/react-dom-client.development.js:[2m7662:22[22m[39m
[90m [2mâ¯[22m updateFunctionComponent node_modules/react-dom/cjs/react-dom-client.development.js:[2m10166:19[22m[39m
[90m [2mâ¯[22m beginWork node_modules/react-dom/cjs/react-dom-client.development.js:[2m11778:18[22m[39m
[90m [2mâ¯[22m runWithFiberInDEV node_modules/react-dom/cjs/react-dom-client.development.js:[2m874:13[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[6/10]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m [30m[42m unit [49m[39m tests/hooks/useDailyRecord.test.ts[2m > [22museDailyRecord[2m > [22mshould not update admissionDate to a future date
[31m[1mError[22m: No QueryClient set, use QueryClientProvider to set one[39m
[90m [2mâ¯[22m useQueryClient node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:[2m15:11[22m[39m
[36m [2mâ¯[22m useDailyRecordSyncQuery hooks/useDailyRecordSyncQuery.ts:[2m19:25[22m[39m
    [90m 17| [39m    _isFirebaseConnected[33m:[39m boolean [33m=[39m [35mfalse[39m
    [90m 18| [39m)[33m:[39m [33mUseDailyRecordSyncResult[39m [33m=>[39m {
    [90m 19| [39m    [35mconst[39m queryClient [33m=[39m [34museQueryClient[39m()[33m;[39m
    [90m   | [39m                        [31m^[39m
    [90m 20| [39m
    [90m 21| [39m    [90m// 1. Fetching[39m
[90m [2mâ¯[22m Module.useDailyRecord hooks/useDailyRecord.ts:[2m72:9[22m[39m
[90m [2mâ¯[22m tests/hooks/useDailyRecord.test.ts:[2m149:45[22m[39m
[90m [2mâ¯[22m TestComponent node_modules/@testing-library/react/dist/pure.js:[2m331:27[22m[39m
[90m [2mâ¯[22m Object.react_stack_bottom_frame node_modules/react-dom/cjs/react-dom-client.development.js:[2m25904:20[22m[39m
[90m [2mâ¯[22m renderWithHooks node_modules/react-dom/cjs/react-dom-client.development.js:[2m7662:22[22m[39m
[90m [2mâ¯[22m updateFunctionComponent node_modules/react-dom/cjs/react-dom-client.development.js:[2m10166:19[22m[39m
[90m [2mâ¯[22m beginWork node_modules/react-dom/cjs/react-dom-client.development.js:[2m11778:18[22m[39m
[90m [2mâ¯[22m runWithFiberInDEV node_modules/react-dom/cjs/react-dom-client.development.js:[2m874:13[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[7/10]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m [30m[42m unit [49m[39m tests/hooks/useDailyRecord.test.ts[2m > [22museDailyRecord[2m > [22mshould not create clinical crib in empty bed
[31m[1mError[22m: No QueryClient set, use QueryClientProvider to set one[39m
[90m [2mâ¯[22m useQueryClient node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:[2m15:11[22m[39m
[36m [2mâ¯[22m useDailyRecordSyncQuery hooks/useDailyRecordSyncQuery.ts:[2m19:25[22m[39m
    [90m 17| [39m    _isFirebaseConnected[33m:[39m boolean [33m=[39m [35mfalse[39m
    [90m 18| [39m)[33m:[39m [33mUseDailyRecordSyncResult[39m [33m=>[39m {
    [90m 19| [39m    [35mconst[39m queryClient [33m=[39m [34museQueryClient[39m()[33m;[39m
    [90m   | [39m                        [31m^[39m
    [90m 20| [39m
    [90m 21| [39m    [90m// 1. Fetching[39m
[90m [2mâ¯[22m Module.useDailyRecord hooks/useDailyRecord.ts:[2m72:9[22m[39m
[90m [2mâ¯[22m tests/hooks/useDailyRecord.test.ts:[2m163:45[22m[39m
[90m [2mâ¯[22m TestComponent node_modules/@testing-library/react/dist/pure.js:[2m331:27[22m[39m
[90m [2mâ¯[22m Object.react_stack_bottom_frame node_modules/react-dom/cjs/react-dom-client.development.js:[2m25904:20[22m[39m
[90m [2mâ¯[22m renderWithHooks node_modules/react-dom/cjs/react-dom-client.development.js:[2m7662:22[22m[39m
[90m [2mâ¯[22m updateFunctionComponent node_modules/react-dom/cjs/react-dom-client.development.js:[2m10166:19[22m[39m
[90m [2mâ¯[22m beginWork node_modules/react-dom/cjs/react-dom-client.development.js:[2m11778:18[22m[39m
[90m [2mâ¯[22m runWithFiberInDEV node_modules/react-dom/cjs/react-dom-client.development.js:[2m874:13[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[8/10]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m [30m[42m unit [49m[39m tests/hooks/useDailyRecord.test.ts[2m > [22museDailyRecord[2m > [22mshould not update crib admissionDate to a future date
[31m[1mError[22m: No QueryClient set, use QueryClientProvider to set one[39m
[90m [2mâ¯[22m useQueryClient node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:[2m15:11[22m[39m
[36m [2mâ¯[22m useDailyRecordSyncQuery hooks/useDailyRecordSyncQuery.ts:[2m19:25[22m[39m
    [90m 17| [39m    _isFirebaseConnected[33m:[39m boolean [33m=[39m [35mfalse[39m
    [90m 18| [39m)[33m:[39m [33mUseDailyRecordSyncResult[39m [33m=>[39m {
    [90m 19| [39m    [35mconst[39m queryClient [33m=[39m [34museQueryClient[39m()[33m;[39m
    [90m   | [39m                        [31m^[39m
    [90m 20| [39m
    [90m 21| [39m    [90m// 1. Fetching[39m
[90m [2mâ¯[22m Module.useDailyRecord hooks/useDailyRecord.ts:[2m72:9[22m[39m
[90m [2mâ¯[22m tests/hooks/useDailyRecord.test.ts:[2m184:45[22m[39m
[90m [2mâ¯[22m TestComponent node_modules/@testing-library/react/dist/pure.js:[2m331:27[22m[39m
[90m [2mâ¯[22m Object.react_stack_bottom_frame node_modules/react-dom/cjs/react-dom-client.development.js:[2m25904:20[22m[39m
[90m [2mâ¯[22m renderWithHooks node_modules/react-dom/cjs/react-dom-client.development.js:[2m7662:22[22m[39m
[90m [2mâ¯[22m updateFunctionComponent node_modules/react-dom/cjs/react-dom-client.development.js:[2m10166:19[22m[39m
[90m [2mâ¯[22m beginWork node_modules/react-dom/cjs/react-dom-client.development.js:[2m11778:18[22m[39m
[90m [2mâ¯[22m runWithFiberInDEV node_modules/react-dom/cjs/react-dom-client.development.js:[2m874:13[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[9/10]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m [30m[42m unit [49m[39m tests/hooks/useDailyRecordSync.test.ts[2m > [22museDailyRecordSync - Reconnection Logic[2m > [22mshould push local data to Firestore if Online and isFirebaseConnected is true
[31m[1mAssertionError[22m: expected "vi.fn()" to be called with arguments: [ { id: 'rec-1', â€¦(3) }, Anything ][90m

Received: 

[1m  1st vi.fn() call:

[22m[33m@@ -3,7 +3,6 @@[90m
[2m      "beds": {},[22m
[2m      "date": "2025-12-27",[22m
[2m      "id": "rec-1",[22m
[2m      "lastUpdated": "2025-12-30T02:17:50.562Z",[22m
[2m    },[22m
[32m-   Anything,[90m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m

Ignored nodes: comments, script, style
[36m<html>[31m
  [36m<head />[31m
  [36m<body>[31m
    [36m<div>[31m
      [36m<div[31m
        [33mclass[31m=[32m"fixed bottom-4 right-4 z-[9999] flex flex-col gap-1"[31m
      [36m/>[31m
    [36m</div>[31m
  [36m</body>[31m
[36m</html>[31m[39m
[36m [2mâ¯[22m tests/hooks/useDailyRecordSync.test.ts:[2m48:48[22m[39m
    [90m 46| [39m        [90m// Verify push logic[39m
    [90m 47| [39m        [35mawait[39m [34mwaitFor[39m(() [33m=>[39m {
    [90m 48| [39m            expect(DailyRecordRepository.save).toHaveBeenCalledWith(moâ€¦
    [90m   | [39m                                               [31m^[39m
    [90m 49| [39m        })[33m;[39m
    [90m 50| [39m    })[33m;[39m
[90m [2mâ¯[22m runWithExpensiveErrorDiagnosticsDisabled node_modules/@testing-library/dom/dist/config.js:[2m47:12[22m[39m
[90m [2mâ¯[22m checkCallback node_modules/@testing-library/dom/dist/wait-for.js:[2m124:77[22m[39m
[90m [2mâ¯[22m Timeout.checkRealTimersCallback node_modules/@testing-library/dom/dist/wait-for.js:[2m118:16[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[10/10]âŽ¯[22m[39m


[2m Test Files [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m69 passed[39m[22m[90m (71)[39m
[2m      Tests [22m [1m[31m10 failed[39m[22m[2m | [22m[1m[32m592 passed[39m[22m[90m (602)[39m
[2m   Start at [22m 21:17:49
[2m   Duration [22m 7.84s[2m (transform 2.94s, setup 13.40s, import 8.82s, tests 5.03s, environment 31.76s)[22m

